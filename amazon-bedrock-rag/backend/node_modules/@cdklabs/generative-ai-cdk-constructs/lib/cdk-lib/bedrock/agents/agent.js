"use strict";
var _a, _b;
Object.defineProperty(exports, "__esModule", { value: true });
exports.Agent = exports.AgentBase = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
/**
 *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License"). You may not use this file except in compliance
 *  with the License. A copy of the License is located at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  or in the 'license' file accompanying this file. This file is distributed on an 'AS IS' BASIS, WITHOUT WARRANTIES
 *  OR CONDITIONS OF ANY KIND, express or implied. See the License for the specific language governing permissions
 *  and limitations under the License.
 */
const aws_cdk_lib_1 = require("aws-cdk-lib");
const bedrock = require("aws-cdk-lib/aws-bedrock");
const iam = require("aws-cdk-lib/aws-iam");
const kms = require("aws-cdk-lib/aws-kms");
// Internal Libs
const action_group_1 = require("./action-group");
const agent_alias_1 = require("./agent-alias");
const utils_1 = require("../../../common/helpers/utils");
const validation = require("../../../common/helpers/validation-helpers");
/******************************************************************************
 *                        ABSTRACT BASE CLASS
 *****************************************************************************/
/**
 * Abstract base class for an Agent.
 * Contains methods and attributes valid for Agents either created with CDK or imported.
 */
class AgentBase extends aws_cdk_lib_1.Resource {
}
exports.AgentBase = AgentBase;
_a = JSII_RTTI_SYMBOL_1;
AgentBase[_a] = { fqn: "@cdklabs/generative-ai-cdk-constructs.bedrock.AgentBase", version: "0.1.296" };
/******************************************************************************
 *                        NEW CONSTRUCT DEFINITION
 *****************************************************************************/
/**
 * Class to create (or import) an Agent with CDK.
 * @cloudformationResource AWS::Bedrock::Agent
 */
class Agent extends AgentBase {
    /**
     * Static Method for importing an existing Bedrock Agent.
     */
    static fromAgentAttrs(scope, id, attrs) {
        class Import extends AgentBase {
            constructor() {
                super(...arguments);
                this.agentArn = attrs.agentArn;
                this.agentId = aws_cdk_lib_1.Arn.split(attrs.agentArn, aws_cdk_lib_1.ArnFormat.SLASH_RESOURCE_NAME).resourceName;
                this.role = iam.Role.fromRoleArn(scope, `${id}Role`, attrs.roleArn);
                this.kmsKey = attrs.kmsKeyArn ? kms.Key.fromKeyArn(scope, `${id}Key`, attrs.kmsKeyArn) : undefined;
                this.lastUpdated = attrs.lastUpdated;
                this.agentVersion = attrs.agentVersion ?? 'DRAFT';
            }
        }
        // Return new Agent
        return new Import(scope, id);
    }
    // ------------------------------------------------------
    // CONSTRUCTOR
    // ------------------------------------------------------
    constructor(scope, id, props) {
        super(scope, id);
        // ------------------------------------------------------
        // Validators
        // ------------------------------------------------------
        /**
         * Checks if the KB Association is valid
         *
         * @internal This is an internal core function and should not be called directly.
         */
        this.validateKnowledgeBase = (knowledgeBase) => {
            const MAX_LENGTH = 200;
            const description = knowledgeBase.instruction ?? knowledgeBase.description;
            const errors = [];
            // If at least one of the previous has been defined
            if (description) {
                errors.push(...validation.validateStringFieldLength({
                    value: description,
                    fieldName: 'description',
                    minLength: 0,
                    maxLength: MAX_LENGTH,
                }));
            }
            else {
                errors.push('If instructionForAgents is not provided, the description property of the KnowledgeBase ' +
                    `${knowledgeBase.knowledgeBaseId} must be provided.`);
            }
            return errors;
        };
        /**
         * Checks if the KB Associations are valid
         *
         * @internal This is an internal core function and should not be called directly.
         */
        this.validateKnowledgeBaseAssocations = () => {
            const MAX_KB_ASSOCIATIONS = 10;
            const errors = [];
            if (this.knowledgeBases.length > MAX_KB_ASSOCIATIONS) {
                errors.push(`The maximum number of knowledge bases associations is ${MAX_KB_ASSOCIATIONS}.`);
            }
            for (const kb of this.knowledgeBases) {
                this.validateKnowledgeBase(kb);
            }
            return errors;
        };
        /**
         * Checks if the Guardrail is valid
         *
         * @internal This is an internal core function and should not be called directly.
         */
        this.validateGuardrail = (guardrail) => {
            const errors = [];
            if (this.guardrail) {
                errors.push(`Cannot add Guardrail ${guardrail.guardrailId}. ` +
                    `Guardrail ${this.guardrail.guardrailId} has already been specified for this agent.`);
            }
            errors.push(...validation.validateFieldPattern(guardrail.guardrailVersion, 'version', /^(([0-9]{1,8})|(DRAFT))$/));
            return errors;
        };
        /**
         * Check if the action group is valid
         */
        this.validateActionGroup = (actionGroup) => {
            console.log('Validating action group: ', actionGroup.name);
            let errors = [];
            // Find if there is a conflicting action group name
            if (this.actionGroups?.find(ag => ag.name === actionGroup.name)) {
                errors.push(`An action group with name: ${actionGroup.name} has already been defined`);
            }
            return errors;
        };
        // ------------------------------------------------------
        // Set properties and defaults
        // ------------------------------------------------------
        this.name =
            props.name ?? (0, utils_1.generatePhysicalNameV2)(this, 'bedrock-agent', { maxLength: 64, lower: true, separator: '-' });
        this.idleSessionTTL = props.idleSessionTTL ?? aws_cdk_lib_1.Duration.hours(1);
        this.shouldPrepareAgent = props.shouldPrepareAgent ?? false;
        this.userInputEnabled = props.userInputEnabled ?? false;
        this.codeInterpreterEnabled = props.codeInterpreterEnabled ?? false;
        this.foundationModel = props.foundationModel;
        this.forceDelete = props.forceDelete ?? false;
        // Optional
        this.description = props.description;
        this.instruction = props.instruction;
        this.promptOverrideConfiguration = props.promptOverrideConfiguration;
        this.kmsKey = props.kmsKey;
        this.memory = props.memory;
        // ------------------------------------------------------
        // Role
        // ------------------------------------------------------
        // If existing role is provided, use it.
        if (props.existingRole) {
            this.role = props.existingRole;
            // Otherwise, create a new one
        }
        else {
            this.role = new iam.Role(this, 'Role', {
                // generate a role name
                roleName: (0, utils_1.generatePhysicalNameV2)(this, 'AmazonBedrockExecutionRoleForAgents_', { maxLength: 64, lower: false }),
                // ensure the role has a trust policy that allows the Bedrock service to assume the role
                assumedBy: new iam.ServicePrincipal('bedrock.amazonaws.com').withConditions({
                    StringEquals: {
                        'aws:SourceAccount': aws_cdk_lib_1.Stack.of(this).account,
                    },
                    ArnLike: {
                        'aws:SourceArn': aws_cdk_lib_1.Stack.of(this).formatArn({
                            service: 'bedrock',
                            resource: 'agent',
                            resourceName: '*',
                            arnFormat: aws_cdk_lib_1.ArnFormat.SLASH_RESOURCE_NAME,
                        }),
                    },
                }),
            });
        }
        // ------------------------------------------------------
        // Set Lazy Props initial values
        // ------------------------------------------------------
        this.knowledgeBases = [];
        this.actionGroups = [];
        // Add Default Action Groups
        this.addActionGroup(action_group_1.AgentActionGroup.userInput(this.userInputEnabled));
        this.addActionGroup(action_group_1.AgentActionGroup.codeInterpreter(this.codeInterpreterEnabled));
        // Add specified elems through methods to handle permissions
        // this needs to happen after role creation / assignment
        props.knowledgeBases?.forEach(kb => {
            this.addKnowledgeBase(kb);
        });
        props.actionGroups?.forEach(ag => {
            this.addActionGroup(ag);
        });
        if (props.guardrail) {
            this.addGuardrail(props.guardrail);
        }
        // ------------------------------------------------------
        // Set Lazy Validations
        // ------------------------------------------------------
        this.node.addValidation({
            validate: () => this.validateKnowledgeBaseAssocations(),
        });
        // ------------------------------------------------------
        // CFN Props - With Lazy support
        // ------------------------------------------------------
        const cfnProps = {
            actionGroups: aws_cdk_lib_1.Lazy.any({ produce: () => this.renderActionGroups() }, { omitEmptyArray: true }),
            agentName: this.name,
            agentResourceRoleArn: this.role.roleArn,
            autoPrepare: this.shouldPrepareAgent,
            customerEncryptionKeyArn: props.kmsKey?.keyArn,
            description: props.description,
            foundationModel: this.foundationModel.invokableArn,
            guardrailConfiguration: aws_cdk_lib_1.Lazy.any({ produce: () => this.renderGuardrail() }),
            idleSessionTtlInSeconds: this.idleSessionTTL.toSeconds(),
            instruction: props.instruction,
            knowledgeBases: aws_cdk_lib_1.Lazy.any({ produce: () => this.renderKnowledgeBases() }, { omitEmptyArray: true }),
            memoryConfiguration: props.memory,
            promptOverrideConfiguration: this.promptOverrideConfiguration?._render(),
            skipResourceInUseCheckOnDelete: this.forceDelete,
        };
        // ------------------------------------------------------
        // L1 Instantiation
        // ------------------------------------------------------
        this.__resource = new bedrock.CfnAgent(this, 'AgentResource', cfnProps);
        this.agentId = this.__resource.attrAgentId;
        this.agentArn = this.__resource.attrAgentArn;
        this.agentVersion = this.__resource.attrAgentVersion;
        this.lastUpdated = this.__resource.attrUpdatedAt;
        // Add explicit dependency between the agent resource and the agent's role default policy
        // See https://github.com/awslabs/generative-ai-cdk-constructs/issues/899
        if (!props.existingRole) {
            // add the appropriate permissions to use the FM
            const grant = this.foundationModel.grantInvoke(this.role);
            grant.applyBefore(this.__resource);
        }
        this.testAlias = agent_alias_1.AgentAlias.fromAttributes(this, 'DefaultAlias', {
            aliasId: 'TSTALIASID',
            aliasName: 'AgentTestAlias',
            agentVersion: 'DRAFT',
            agent: this,
        });
    }
    // ------------------------------------------------------
    // HELPER METHODS - addX()
    // ------------------------------------------------------
    /**
     * Add knowledge base to the agent.
     */
    addKnowledgeBase(knowledgeBase) {
        // Do some checks
        validation.throwIfInvalid(this.validateKnowledgeBase, knowledgeBase);
        // Add it to the array
        this.knowledgeBases.push(knowledgeBase);
        // Add the appropriate Permissions to query the Knowledge Base
        knowledgeBase.grantQuery(this.role);
    }
    /**
     * Add guardrail to the agent.
     */
    addGuardrail(guardrail) {
        // Do some checks
        validation.throwIfInvalid(this.validateGuardrail, guardrail);
        // Add it to the construct
        this.guardrail = guardrail;
        // Handle permissions
        guardrail.grantApply(this.role);
    }
    /**
     * Add an action group to the agent.
     */
    addActionGroup(actionGroup) {
        // Do some checks
        validation.throwIfInvalid(this.validateActionGroup, actionGroup);
        // Add it to the array
        this.actionGroups.push(actionGroup);
        // Handle permissions to invoke the lambda function
        actionGroup.executor?.lambdaFunction?.grantInvoke(this.role);
        actionGroup.executor?.lambdaFunction?.addPermission(`LambdaInvocationPolicy-${this.node.addr.slice(0, 16)}`, {
            principal: new iam.ServicePrincipal('bedrock.amazonaws.com'),
            sourceArn: this.agentArn,
            sourceAccount: aws_cdk_lib_1.Stack.of(this).account,
        });
    }
    /**
     * Add multiple action groups to the agent.
     */
    addActionGroups(...actionGroups) {
        actionGroups.forEach(ag => this.addActionGroup(ag));
    }
    // ------------------------------------------------------
    // Lazy Renderers
    // ------------------------------------------------------
    /**
     * Render the guardrail configuration.
     *
     * @internal This is an internal core function and should not be called directly.
     */
    renderGuardrail() {
        return this.guardrail
            ? {
                guardrailIdentifier: this.guardrail.guardrailId,
                guardrailVersion: this.guardrail.guardrailVersion,
            }
            : undefined;
    }
    /**
     * Render the knowledge base associations.
     *
     * @internal This is an internal core function and should not be called directly.
     */
    renderKnowledgeBases() {
        const knowledgeBaseAssociationsCfn = [];
        // Build the associations in the CFN format
        this.knowledgeBases.forEach(kb => {
            knowledgeBaseAssociationsCfn.push({
                knowledgeBaseId: kb.knowledgeBaseId,
                knowledgeBaseState: 'ENABLED',
                // at least one is defined as it has been validated when adding the kb
                description: kb.instruction ?? kb.description,
            });
        });
        return knowledgeBaseAssociationsCfn;
    }
    /**
     * Render the action groups
     *
     * @internal This is an internal core function and should not be called directly.
     */
    renderActionGroups() {
        const actionGroupsCfn = [];
        // Build the associations in the CFN format
        this.actionGroups.forEach(ag => {
            actionGroupsCfn.push(ag._render());
        });
        return actionGroupsCfn;
    }
}
exports.Agent = Agent;
_b = JSII_RTTI_SYMBOL_1;
Agent[_b] = { fqn: "@cdklabs/generative-ai-cdk-constructs.bedrock.Agent", version: "0.1.296" };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWdlbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY2RrLWxpYi9iZWRyb2NrL2FnZW50cy9hZ2VudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBOzs7Ozs7Ozs7OztHQVdHO0FBRUgsNkNBQXlGO0FBQ3pGLG1EQUFtRDtBQUNuRCwyQ0FBMkM7QUFDM0MsMkNBQTJDO0FBRTNDLGdCQUFnQjtBQUNoQixpREFBa0Q7QUFDbEQsK0NBQXdEO0FBRXhELHlEQUF1RTtBQUN2RSx5RUFBeUU7QUFzQ3pFOzsrRUFFK0U7QUFDL0U7OztHQUdHO0FBQ0gsTUFBc0IsU0FBVSxTQUFRLHNCQUFROztBQUFoRCw4QkFPQzs7O0FBNElEOzsrRUFFK0U7QUFDL0U7OztHQUdHO0FBQ0gsTUFBYSxLQUFNLFNBQVEsU0FBUztJQUNsQzs7T0FFRztJQUNJLE1BQU0sQ0FBQyxjQUFjLENBQUMsS0FBZ0IsRUFBRSxFQUFVLEVBQUUsS0FBc0I7UUFDL0UsTUFBTSxNQUFPLFNBQVEsU0FBUztZQUE5Qjs7Z0JBQ2tCLGFBQVEsR0FBRyxLQUFLLENBQUMsUUFBUSxDQUFDO2dCQUMxQixZQUFPLEdBQUcsaUJBQUcsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLFFBQVEsRUFBRSx1QkFBUyxDQUFDLG1CQUFtQixDQUFDLENBQUMsWUFBYSxDQUFDO2dCQUNqRixTQUFJLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUFFLEdBQUcsRUFBRSxNQUFNLEVBQUUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO2dCQUMvRCxXQUFNLEdBQUcsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsS0FBSyxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUM7Z0JBQzlGLGdCQUFXLEdBQUcsS0FB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QUFtQixFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsV0FBVztnQkFDL0MsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxnQkFBZ0I7YUFDbEQ7WUFDRCxDQUFDLENBQUMsU0FBUyxDQUFDO0lBQ2hCLENBQUM7SUFFRDs7OztPQUlHO0lBQ0ssb0JBQW9CO1FBQzFCLE1BQU0sNEJBQTRCLEdBQWtELEVBQUUsQ0FBQztRQUN2RiwyQ0FBMkM7UUFDM0MsSUFBSSxDQUFDLGNBQWMsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLEVBQUU7WUFDL0IsNEJBQTRCLENBQUMsSUFBSSxDQUFDO2dCQUNoQyxlQUFlLEVBQUUsRUFBRSxDQUFDLGVBQWU7Z0JBQ25DLGtCQUFrQixFQUFFLFNBQVM7Z0JBQzdCLHNFQUFzRTtnQkFDdEUsV0FBVyxFQUFFLEVBQUUsQ0FBQyxXQUFXLElBQUksRUFBRSxDQUFDLFdBQVk7YUFDL0MsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7UUFDSCxPQUFPLDRCQUE0QixDQUFDO0lBQ3RDLENBQUM7SUFFRDs7OztPQUlHO0lBQ0ssa0JBQWtCO1FBQ3hCLE1BQU0sZUFBZSxHQUFnRCxFQUFFLENBQUM7UUFDeEUsMkNBQTJDO1FBQzNDLElBQUksQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxFQUFFO1lBQzdCLGVBQWUsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUM7UUFDckMsQ0FBQyxDQUFDLENBQUM7UUFDSCxPQUFPLGVBQWUsQ0FBQztJQUN6QixDQUFDOztBQTlWSCxzQkEwYUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqICBDb3B5cmlnaHQgQW1hem9uLmNvbSwgSW5jLiBvciBpdHMgYWZmaWxpYXRlcy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqXG4gKiAgTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKS4gWW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZVxuICogIHdpdGggdGhlIExpY2Vuc2UuIEEgY29weSBvZiB0aGUgTGljZW5zZSBpcyBsb2NhdGVkIGF0XG4gKlxuICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiAgb3IgaW4gdGhlICdsaWNlbnNlJyBmaWxlIGFjY29tcGFueWluZyB0aGlzIGZpbGUuIFRoaXMgZmlsZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAnQVMgSVMnIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVNcbiAqICBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBleHByZXNzIG9yIGltcGxpZWQuIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9uc1xuICogIGFuZCBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBBcm4sIEFybkZvcm1hdCwgRHVyYXRpb24sIElSZXNvdXJjZSwgTGF6eSwgUmVzb3VyY2UsIFN0YWNrIH0gZnJvbSAnYXdzLWNkay1saWInO1xuaW1wb3J0ICogYXMgYmVkcm9jayBmcm9tICdhd3MtY2RrLWxpYi9hd3MtYmVkcm9jayc7XG5pbXBvcnQgKiBhcyBpYW0gZnJvbSAnYXdzLWNkay1saWIvYXdzLWlhbSc7XG5pbXBvcnQgKiBhcyBrbXMgZnJvbSAnYXdzLWNkay1saWIvYXdzLWttcyc7XG5pbXBvcnQgeyBDb25zdHJ1Y3QgfSBmcm9tICdjb25zdHJ1Y3RzJztcbi8vIEludGVybmFsIExpYnNcbmltcG9ydCB7IEFnZW50QWN0aW9uR3JvdXAgfSBmcm9tICcuL2FjdGlvbi1ncm91cCc7XG5pbXBvcnQgeyBBZ2VudEFsaWFzLCBJQWdlbnRBbGlhcyB9IGZyb20gJy4vYWdlbnQtYWxpYXMnO1xuaW1wb3J0IHsgUHJvbXB0T3ZlcnJpZGVDb25maWd1cmF0aW9uIH0gZnJvbSAnLi9wcm9tcHQtb3ZlcnJpZGUnO1xuaW1wb3J0IHsgZ2VuZXJhdGVQaHlzaWNhbE5hbWVWMiB9IGZyb20gJy4uLy4uLy4uL2NvbW1vbi9oZWxwZXJzL3V0aWxzJztcbmltcG9ydCAqIGFzIHZhbGlkYXRpb24gZnJvbSAnLi4vLi4vLi4vY29tbW9uL2hlbHBlcnMvdmFsaWRhdGlvbi1oZWxwZXJzJztcbmltcG9ydCB7IElHdWFyZHJhaWwgfSBmcm9tICcuLi9ndWFyZHJhaWxzL2d1YXJkcmFpbHMnO1xuaW1wb3J0IHsgSUtub3dsZWRnZUJhc2UgfSBmcm9tICcuLi9rbm93bGVkZ2UtYmFzZXMva25vd2xlZGdlLWJhc2UnO1xuaW1wb3J0IHsgSUludm9rYWJsZSB9IGZyb20gJy4uL21vZGVscyc7XG5pbXBvcnQgeyBNZW1vcnkgfSBmcm9tICcuL21lbW9yeSc7XG5cbi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ09NTU9OXG4gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG4vKipcbiAqIFJlcHJlc2VudHMgYW4gQWdlbnQsIGVpdGhlciBjcmVhdGVkIHdpdGggQ0RLIG9yIGltcG9ydGVkLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIElBZ2VudCBleHRlbmRzIElSZXNvdXJjZSB7XG4gIC8qKlxuICAgKiBUaGUgQVJOIG9mIHRoZSBhZ2VudC5cbiAgICogQGV4YW1wbGUgXCJhcm46YXdzOmJlZHJvY2s6dXMtZWFzdC0xOjEyMzQ1Njc4OTAxMjphZ2VudC9PS0RTSk9HS01PXCJcbiAgICogQGF0dHJpYnV0ZVxuICAgKi9cbiAgcmVhZG9ubHkgYWdlbnRBcm46IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSBJRCBvZiB0aGUgQWdlbnQuXG4gICAqIEBleGFtcGxlIFwiT0tEU0pPR0tNT1wiXG4gICAqIEBhdHRyaWJ1dGVcbiAgICovXG4gIHJlYWRvbmx5IGFnZW50SWQ6IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSBJQU0gcm9sZSBhc3NvY2lhdGVkIHRvIHRoZSBhZ2VudC5cbiAgICovXG4gIHJlYWRvbmx5IHJvbGU6IGlhbS5JUm9sZTtcbiAgLyoqXG4gICAqIE9wdGlvbmFsIEtNUyBlbmNyeXB0aW9uIGtleSBhc3NvY2lhdGVkIHdpdGggdGhpcyBhZ2VudFxuICAgKi9cbiAgcmVhZG9ubHkga21zS2V5Pzoga21zLklLZXk7XG4gIC8qKlxuICAgKiBXaGVuIHRoaXMgYWdlbnQgd2FzIGxhc3QgdXBkYXRlZC5cbiAgICovXG4gIHJlYWRvbmx5IGxhc3RVcGRhdGVkPzogc3RyaW5nO1xufVxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuICogICAgICAgICAgICAgICAgICAgICAgICBBQlNUUkFDVCBCQVNFIENMQVNTXG4gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG4vKipcbiAqIEFic3RyYWN0IGJhc2UgY2xhc3MgZm9yIGFuIEFnZW50LlxuICogQ29udGFpbnMgbWV0aG9kcyBhbmQgYXR0cmlidXRlcyB2YWxpZCBmb3IgQWdlbnRzIGVpdGhlciBjcmVhdGVkIHdpdGggQ0RLIG9yIGltcG9ydGVkLlxuICovXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgQWdlbnRCYXNlIGV4dGVuZHMgUmVzb3VyY2UgaW1wbGVtZW50cyBJQWdlbnQge1xuICBwdWJsaWMgYWJzdHJhY3QgcmVhZG9ubHkgYWdlbnRBcm46IHN0cmluZztcbiAgcHVibGljIGFic3RyYWN0IHJlYWRvbmx5IGFnZW50SWQ6IHN0cmluZztcbiAgcHVibGljIGFic3RyYWN0IHJlYWRvbmx5IHJvbGU6IGlhbS5JUm9sZTtcbiAgcHVibGljIGFic3RyYWN0IHJlYWRvbmx5IGttc0tleT86IGttcy5JS2V5O1xuICBwdWJsaWMgYWJzdHJhY3QgcmVhZG9ubHkgbGFzdFVwZGF0ZWQ/OiBzdHJpbmc7XG4gIHB1YmxpYyBhYnN0cmFjdCBhZ2VudFZlcnNpb246IHN0cmluZztcbn1cblxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuICogICAgICAgICAgICAgICAgICAgICAgICBQUk9QUyBGT1IgTkVXIENPTlNUUlVDVFxuICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuLyoqXG4gKiBQcm9wZXJ0aWVzIGZvciBjcmVhdGluZyBhIENESyBtYW5hZ2VkIEJlZHJvY2sgQWdlbnQuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQWdlbnRQcm9wcyB7XG4gIC8qKlxuICAgKiBUaGUgbmFtZSBvZiB0aGUgYWdlbnQuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gQSBuYW1lIGlzIGdlbmVyYXRlZCBieSBDREsuXG4gICAqL1xuICByZWFkb25seSBuYW1lPzogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIGluc3RydWN0aW9uIHVzZWQgYnkgdGhlIGFnZW50LiBUaGlzIGRldGVybWluZXMgaG93IHRoZSBhZ2VudCB3aWxsIHBlcmZvcm0gaGlzIHRhc2suXG4gICAqIFRoaXMgaW5zdHJ1Y3Rpb24gbXVzdCBoYXZlIGEgbWluaW11bSBvZiA0MCBjaGFyYWN0ZXJzLlxuICAgKi9cbiAgcmVhZG9ubHkgaW5zdHJ1Y3Rpb246IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSBmb3VuZGF0aW9uIG1vZGVsIHVzZWQgZm9yIG9yY2hlc3RyYXRpb24gYnkgdGhlIGFnZW50LlxuICAgKi9cbiAgcmVhZG9ubHkgZm91bmRhdGlvbk1vZGVsOiBJSW52b2thYmxlO1xuICAvKipcbiAgICogVGhlIGV4aXN0aW5nIElBTSBSb2xlIGZvciB0aGUgYWdlbnQgdG8gdXNlLlxuICAgKiBFbnN1cmUgdGhlIHJvbGUgaGFzIGEgdHJ1c3QgcG9saWN5IHRoYXQgYWxsb3dzIHRoZSBCZWRyb2NrIHNlcnZpY2UgdG8gYXNzdW1lIHRoZSByb2xlLlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIEEgbmV3IHJvbGUgaXMgY3JlYXRlZCBmb3IgeW91LlxuICAgKi9cbiAgcmVhZG9ubHkgZXhpc3RpbmdSb2xlPzogaWFtLklSb2xlO1xuICAvKipcbiAgICogU3BlY2lmaWVzIHdoZXRoZXIgdG8gYXV0b21hdGljYWxseSB1cGRhdGUgdGhlIGBEUkFGVGAgdmVyc2lvbiBvZiB0aGUgYWdlbnQgYWZ0ZXJcbiAgICogbWFraW5nIGNoYW5nZXMgdG8gdGhlIGFnZW50LiBUaGUgYERSQUZUYCB2ZXJzaW9uIGNhbiBiZSBjb250aW51YWxseSBpdGVyYXRlZFxuICAgKiB1cG9uIGR1cmluZyBpbnRlcm5hbCBkZXZlbG9wbWVudC5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBmYWxzZVxuICAgKi9cbiAgcmVhZG9ubHkgc2hvdWxkUHJlcGFyZUFnZW50PzogYm9vbGVhbjtcbiAgLyoqXG4gICAqIEhvdyBsb25nIHNlc3Npb25zIHNob3VsZCBiZSBrZXB0IG9wZW4gZm9yIHRoZSBhZ2VudC4gSWYgbm8gY29udmVyc2F0aW9uIG9jY3Vyc1xuICAgKiBkdXJpbmcgdGhpcyB0aW1lLCB0aGUgc2Vzc2lvbiBleHBpcmVzIGFuZCBBbWF6b24gQmVkcm9jayBkZWxldGVzIGFueSBkYXRhXG4gICAqIHByb3ZpZGVkIGJlZm9yZSB0aGUgdGltZW91dC5cbiAgICpcbiAgICogQGRlZmF1bHQgLSAxIGhvdXJcbiAgICovXG4gIHJlYWRvbmx5IGlkbGVTZXNzaW9uVFRMPzogRHVyYXRpb247XG4gIC8qKlxuICAgKiBUaGUgS01TIGtleSBvZiB0aGUgYWdlbnQgaWYgY3VzdG9tIGVuY3J5cHRpb24gaXMgY29uZmlndXJlZC5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBBbiBBV1MgbWFuYWdlZCBrZXkgaXMgdXNlZC5cbiAgICovXG4gIHJlYWRvbmx5IGttc0tleT86IGttcy5JS2V5O1xuICAvKipcbiAgICogQSBkZXNjcmlwdGlvbiBvZiB0aGUgYWdlbnQuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gTm8gZGVzY3JpcHRpb24gaXMgcHJvdmlkZWQuXG4gICAqL1xuICByZWFkb25seSBkZXNjcmlwdGlvbj86IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSBLbm93bGVkZ2VCYXNlcyBhc3NvY2lhdGVkIHdpdGggdGhlIGFnZW50LlxuICAgKi9cbiAgcmVhZG9ubHkga25vd2xlZGdlQmFzZXM/OiBJS25vd2xlZGdlQmFzZVtdO1xuICAvKipcbiAgICogVGhlIEFjdGlvbiBHcm91cHMgYXNzb2NpYXRlZCB3aXRoIHRoZSBhZ2VudC5cbiAgICovXG4gIHJlYWRvbmx5IGFjdGlvbkdyb3Vwcz86IEFnZW50QWN0aW9uR3JvdXBbXTtcbiAgLyoqXG4gICAqIFRoZSBndWFyZHJhaWwgdGhhdCB3aWxsIGJlIGFzc29jaWF0ZWQgd2l0aCB0aGUgYWdlbnQuXG4gICAqL1xuICByZWFkb25seSBndWFyZHJhaWw/OiBJR3VhcmRyYWlsO1xuICAvKipcbiAgICogT3ZlcnJpZGVzIHNvbWUgcHJvbXB0IHRlbXBsYXRlcyBpbiBkaWZmZXJlbnQgcGFydHMgb2YgYW4gYWdlbnQgc2VxdWVuY2UgY29uZmlndXJhdGlvbi5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBObyBvdmVycmlkZXMgYXJlIHByb3ZpZGVkLlxuICAgKi9cbiAgcmVhZG9ubHkgcHJvbXB0T3ZlcnJpZGVDb25maWd1cmF0aW9uPzogUHJvbXB0T3ZlcnJpZGVDb25maWd1cmF0aW9uO1xuICAvKipcbiAgICogU2VsZWN0IHdoZXRoZXIgdGhlIGFnZW50IGNhbiBwcm9tcHQgYWRkaXRpb25hbCBpbmZvcm1hdGlvbiBmcm9tIHRoZSB1c2VyIHdoZW4gaXQgZG9lcyBub3QgaGF2ZVxuICAgKiBlbm91Z2ggaW5mb3JtYXRpb24gdG8gcmVzcG9uZCB0byBhbiB1dHRlcmFuY2VcbiAgICpcbiAgICogQGRlZmF1bHQgLSBmYWxzZVxuICAgKi9cbiAgcmVhZG9ubHkgdXNlcklucHV0RW5hYmxlZD86IGJvb2xlYW47XG4gIC8qKlxuICAgKiBTZWxlY3Qgd2hldGhlciB0aGUgYWdlbnQgY2FuIGdlbmVyYXRlLCBydW4sIGFuZCB0cm91Ymxlc2hvb3QgY29kZSB3aGVuIHRyeWluZyB0byBjb21wbGV0ZSBhIHRhc2tcbiAgICpcbiAgICogQGRlZmF1bHQgLSBmYWxzZVxuICAgKi9cbiAgcmVhZG9ubHkgY29kZUludGVycHJldGVyRW5hYmxlZD86IGJvb2xlYW47XG4gIC8qKlxuICAgKiBXaGV0aGVyIHRvIGRlbGV0ZSB0aGUgcmVzb3VyY2UgZXZlbiBpZiBpdCdzIGluIHVzZS5cbiAgICpcbiAgICogQGRlZmF1bHQgLSB0cnVlXG4gICAqL1xuICByZWFkb25seSBmb3JjZURlbGV0ZT86IGJvb2xlYW47XG4gIC8qKlxuICAgKiBUaGUgdHlwZSBhbmQgY29uZmlndXJhdGlvbiBvZiB0aGUgbWVtb3J5IHRvIG1haW50YWluIGNvbnRleHQgYWNyb3NzIG11bHRpcGxlIHNlc3Npb25zIGFuZCByZWNhbGwgcGFzdCBpbnRlcmFjdGlvbnMuXG4gICAqIFRoaXMgY2FuIGJlIHVzZWZ1bCBmb3IgbWFpbnRhaW5pbmcgY29udGludWl0eSBpbiBtdWx0aS10dXJuIGNvbnZlcnNhdGlvbnMgYW5kIHJlY2FsbGluZyB1c2VyIHByZWZlcmVuY2VzXG4gICAqIG9yIHBhc3QgaW50ZXJhY3Rpb25zLlxuICAgKlxuICAgKiBAc2VlIGh0dHBzOi8vZG9jcy5hd3MuYW1hem9uLmNvbS9iZWRyb2NrL2xhdGVzdC91c2VyZ3VpZGUvYWdlbnRzLW1lbW9yeS5odG1sXG4gICAqIEBkZWZhdWx0IC0gTm8gbWVtb3J5IHdpbGwgYmUgdXNlZC4gQWdlbnRzIHdpbGwgcmV0YWluIGNvbnRleHQgZnJvbSB0aGUgY3VycmVudCBzZXNzaW9uIG9ubHkuXG4gICAqL1xuICByZWFkb25seSBtZW1vcnk/OiBNZW1vcnk7XG59XG4vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gKiAgICAgICAgICAgICAgICAgICAgICBBVFRSUyBGT1IgSU1QT1JURUQgQ09OU1RSVUNUXG4gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG4vKipcbiAqIEF0dHJpYnV0ZXMgZm9yIHNwZWNpZnlpbmcgYW4gaW1wb3J0ZWQgQmVkcm9jayBBZ2VudC5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBBZ2VudEF0dHJpYnV0ZXMge1xuICAvKipcbiAgICogVGhlIEFSTiBvZiB0aGUgYWdlbnQuXG4gICAqIEBleGFtcGxlIFwiYXJuOmF3czpiZWRyb2NrOnVzLWVhc3QtMToxMjM0NTY3ODkwMTI6YWdlbnQvT0tEU0pPR0tNT1wiXG4gICAqIEBhdHRyaWJ1dGVcbiAgICovXG4gIHJlYWRvbmx5IGFnZW50QXJuOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgQVJOIG9mIHRoZSBJQU0gcm9sZSBhc3NvY2lhdGVkIHRvIHRoZSBhZ2VudC5cbiAgICogQGV4YW1wbGUgXCJYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYXCJcbiAgICogQGF0dHJpYnV0ZVxuICAgKi9cbiAgcmVhZG9ubHkgcm9sZUFybjogc3RyaW5nO1xuICAvKipcbiAgICogT3B0aW9uYWwgS01TIGVuY3J5cHRpb24ga2V5IGFzc29jaWF0ZWQgd2l0aCB0aGlzIGFnZW50XG4gICAqL1xuICByZWFkb25seSBrbXNLZXlBcm4/OiBzdHJpbmc7XG4gIC8qKlxuICAgKiBXaGVuIHRoaXMgYWdlbnQgd2FzIGxhc3QgdXBkYXRlZC5cbiAgICovXG4gIHJlYWRvbmx5IGxhc3RVcGRhdGVkPzogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIGFnZW50IHZlcnNpb24uIElmIG5vIGV4cGxpY2l0IHZlcnNpb25zIGhhdmUgYmVlbiBjcmVhdGVkLFxuICAgKiBsZWF2ZSB0aGlzICBlbXB0eSB0byB1c2UgdGhlIERSQUZUIHZlcnNpb24uIE90aGVyd2lzZSwgdXNlIHRoZVxuICAgKiB2ZXJzaW9uIG51bWJlciAoZS5nLiAxKS5cbiAgICovXG4gIHJlYWRvbmx5IGFnZW50VmVyc2lvbj86IHN0cmluZztcbn1cbi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcbiAqICAgICAgICAgICAgICAgICAgICAgICAgTkVXIENPTlNUUlVDVCBERUZJTklUSU9OXG4gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG4vKipcbiAqIENsYXNzIHRvIGNyZWF0ZSAob3IgaW1wb3J0KSBhbiBBZ2VudCB3aXRoIENESy5cbiAqIEBjbG91ZGZvcm1hdGlvblJlc291cmNlIEFXUzo6QmVkcm9jazo6QWdlbnRcbiAqL1xuZXhwb3J0IGNsYXNzIEFnZW50IGV4dGVuZHMgQWdlbnRCYXNlIHtcbiAgLyoqXG4gICAqIFN0YXRpYyBNZXRob2QgZm9yIGltcG9ydGluZyBhbiBleGlzdGluZyBCZWRyb2NrIEFnZW50LlxuICAgKi9cbiAgcHVibGljIHN0YXRpYyBmcm9tQWdlbnRBdHRycyhzY29wZTogQ29uc3RydWN0LCBpZDogc3RyaW5nLCBhdHRyczogQWdlbnRBdHRyaWJ1dGVzKTogSUFnZW50IHtcbiAgICBjbGFzcyBJbXBvcnQgZXh0ZW5kcyBBZ2VudEJhc2Uge1xuICAgICAgcHVibGljIHJlYWRvbmx5IGFnZW50QXJuID0gYXR0cnMuYWdlbnRBcm47XG4gICAgICBwdWJsaWMgcmVhZG9ubHkgYWdlbnRJZCA9IEFybi5zcGxpdChhdHRycy5hZ2VudEFybiwgQXJuRm9ybWF0LlNMQVNIX1JFU09VUkNFX05BTUUpLnJlc291cmNlTmFtZSE7XG4gICAgICBwdWJsaWMgcmVhZG9ubHkgcm9sZSA9IGlhbS5Sb2xlLmZyb21Sb2xlQXJuKHNjb3BlLCBgJHtpZH1Sb2xlYCwgYXR0cnMucm9sZUFybik7XG4gICAgICBwdWJsaWMgcmVhZG9ubHkga21zS2V5ID0gYXR0cnMua21zS2V5QXJuID8ga21zLktleS5mcm9tS2V5QXJuKHNjb3BlLCBgJHtpZH1LZXlgLCBhdHRycy5rbXNLZXlBcm4pIDogdW5kZWZpbmVkO1xuICAgICAgcHVibGljIHJlYWRvbmx5IGxhc3RVcGRhdGVkID0gYXR0cnMubGFzdFVwZGF0ZWQ7XG4gICAgICBwdWJsaWMgcmVhZG9ubHkgYWdlbnRWZXJzaW9uID0gYXR0cnMuYWdlbnRWZXJzaW9uID8/ICdEUkFGVCc7XG4gICAgfVxuXG4gICAgLy8gUmV0dXJuIG5ldyBBZ2VudFxuICAgIHJldHVybiBuZXcgSW1wb3J0KHNjb3BlLCBpZCk7XG4gIH1cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIEJhc2UgYXR0cmlidXRlc1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLyoqXG4gICAqIFRoZSB1bmlxdWUgaWRlbnRpZmllciBmb3IgdGhlIGFnZW50XG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgYWdlbnRJZDogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIEFSTiBvZiB0aGUgYWdlbnQuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgYWdlbnRBcm46IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSB2ZXJzaW9uIG9mIHRoZSBhZ2VudC5cbiAgICovXG4gIHB1YmxpYyBhZ2VudFZlcnNpb246IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSBJQU0gcm9sZSBhc3NvY2lhdGVkIHRvIHRoZSBhZ2VudC5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSByb2xlOiBpYW0uSVJvbGU7XG4gIC8qKlxuICAgKiBPcHRpb25hbCBLTVMgZW5jcnlwdGlvbiBrZXkgYXNzb2NpYXRlZCB3aXRoIHRoaXMgYWdlbnRcbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBrbXNLZXk/OiBrbXMuSUtleTtcbiAgLyoqXG4gICAqIFdoZW4gdGhpcyBhZ2VudCB3YXMgbGFzdCB1cGRhdGVkLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGxhc3RVcGRhdGVkPzogc3RyaW5nO1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gQ0RLLW9ubHkgYXR0cmlidXRlc1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLyoqXG4gICAqIFRoZSBuYW1lIG9mIHRoZSBhZ2VudC5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBuYW1lOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBXaGV0aGVyIHRoZSBhZ2VudCB3aWxsIGF1dG9tYXRpY2FsbHkgdXBkYXRlIHRoZSBEUkFGVCB2ZXJzaW9uIG9mIHRoZSBhZ2VudCBhZnRlclxuICAgKiBtYWtpbmcgY2hhbmdlcyB0byB0aGUgYWdlbnQuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgc2hvdWxkUHJlcGFyZUFnZW50OiBib29sZWFuO1xuICAvKipcbiAgICogSG93IGxvbmcgc2Vzc2lvbnMgc2hvdWxkIGJlIGtlcHQgb3BlbiBmb3IgdGhlIGFnZW50LlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGlkbGVTZXNzaW9uVFRMOiBEdXJhdGlvbjtcbiAgLyoqXG4gICAqIFRoZSBmb3VuZGF0aW9uIG1vZGVsIHVzZWQgZm9yIG9yY2hlc3RyYXRpb24gYnkgdGhlIGFnZW50LlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGZvdW5kYXRpb25Nb2RlbDogSUludm9rYWJsZTtcbiAgLyoqXG4gICAqIFRoZSBkZWZhdWx0IHRlc3QgYWxpYXMgZm9yIHRoaXMgYWdlbnQuIFRoaXMgY29ycmVzcG9uZHMgdG8gdGhlIHRlc3QgYWxpYXNcbiAgICogKGBUU1RBTElBU0lEYCkgdGhhdCBwb2ludHMgdG8gdGhlIHdvcmtpbmcgKGBEUkFGVGApIHZlcnNpb24uXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgdGVzdEFsaWFzOiBJQWdlbnRBbGlhcztcbiAgLyoqXG4gICAqIFdoZXRoZXIgdGhlIGFnZW50IGNhbiBwcm9tcHQgYWRkaXRpb25hbCBpbmZvcm1hdGlvbiBmcm9tIHRoZSB1c2VyIHdoZW4gaXQgZG9lcyBub3QgaGF2ZVxuICAgKiBlbm91Z2ggaW5mb3JtYXRpb24gdG8gcmVzcG9uZCB0byBhbiB1dHRlcmFuY2VcbiAgICovXG4gIHB1YmxpYyByZWFkb25seSB1c2VySW5wdXRFbmFibGVkOiBib29sZWFuO1xuICAvKipcbiAgICogV2hldGhlciB0aGUgYWdlbnQgY2FuIGdlbmVyYXRlLCBydW4sIGFuZCB0cm91Ymxlc2hvb3QgY29kZSB3aGVuIHRyeWluZyB0byBjb21wbGV0ZSBhIHRhc2suXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgY29kZUludGVycHJldGVyRW5hYmxlZDogYm9vbGVhbjtcbiAgLyoqXG4gICAqIFdoZXRoZXIgdGhlIHJlc291cmNlIHdpbGwgYmUgZGVsZXRlZCBldmVuIGlmIGl0J3MgaW4gdXNlLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGZvcmNlRGVsZXRlOiBib29sZWFuO1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gQ0RLLW9ubHkgYXR0cmlidXRlcyAob3B0aW9uYWwpXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvKipcbiAgICogVGhlIGRlc2NyaXB0aW9uIGZvciB0aGUgYWdlbnQuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgZGVzY3JpcHRpb24/OiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgaW5zdHJ1Y3Rpb24gdXNlZCBieSB0aGUgYWdlbnQuIFRoaXMgZGV0ZXJtaW5lcyBob3cgdGhlIGFnZW50IHdpbGwgcGVyZm9ybSBoaXMgdGFzay5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBpbnN0cnVjdGlvbj86IHN0cmluZztcbiAgLyoqXG4gICAqIE92ZXJyaWRlcyBzb21lIHByb21wdCB0ZW1wbGF0ZXMgaW4gZGlmZmVyZW50IHBhcnRzIG9mIGFuIGFnZW50IHNlcXVlbmNlIGNvbmZpZ3VyYXRpb24uXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gTm8gb3ZlcnJpZGVzIGFyZSBwcm92aWRlZC5cbiAgICovXG4gIHJlYWRvbmx5IHByb21wdE92ZXJyaWRlQ29uZmlndXJhdGlvbj86IFByb21wdE92ZXJyaWRlQ29uZmlndXJhdGlvbjtcbiAgLyoqXG4gICAqIFRoZSBtZW1vcnkgY29uZmlndXJhdGlvbiBmb3IgdGhlIGFnZW50LlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IG1lbW9yeT86IE1lbW9yeTtcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIExhenkgQXR0cmlidXRlc1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLyoqXG4gICAqIFRoZSBhY3Rpb24gZ3JvdXBzIGFzc29jaWF0ZWQgd2l0aCB0aGUgYWdlbnQuXG4gICAqL1xuICBwdWJsaWMgYWN0aW9uR3JvdXBzOiBBZ2VudEFjdGlvbkdyb3VwW107XG4gIC8qKlxuICAgKiBUaGUgS25vd2xlZGdlQmFzZXMgYXNzb2NpYXRlZCB3aXRoIHRoZSBhZ2VudC5cbiAgICovXG4gIHB1YmxpYyBrbm93bGVkZ2VCYXNlczogSUtub3dsZWRnZUJhc2VbXTtcbiAgLyoqXG4gICAqIFRoZSBndWFyZHJhaWwgYXNzb2NpYXRlZCB3aXRoIHRoZSBhZ2VudC5cbiAgICovXG4gIHB1YmxpYyBndWFyZHJhaWw/OiBJR3VhcmRyYWlsO1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gSW50ZXJuYWwgT25seVxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLyoqXG4gICAqIFRoZSBMMSByZXByZXNlbnRhdGlvbiBvZiB0aGUgYWdlbnRcbiAgICovXG4gIHByaXZhdGUgcmVhZG9ubHkgX19yZXNvdXJjZTogYmVkcm9jay5DZm5BZ2VudDtcblxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gQ09OU1RSVUNUT1JcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIGNvbnN0cnVjdG9yKHNjb3BlOiBDb25zdHJ1Y3QsIGlkOiBzdHJpbmcsIHByb3BzOiBBZ2VudFByb3BzKSB7XG4gICAgc3VwZXIoc2NvcGUsIGlkKTtcblxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vIFNldCBwcm9wZXJ0aWVzIGFuZCBkZWZhdWx0c1xuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIHRoaXMubmFtZSA9XG4gICAgICBwcm9wcy5uYW1lID8/IGdlbmVyYXRlUGh5c2ljYWxOYW1lVjIodGhpcywgJ2JlZHJvY2stYWdlbnQnLCB7IG1heExlbmd0aDogNjQsIGxvd2VyOiB0cnVlLCBzZXBhcmF0b3I6ICctJyB9KTtcbiAgICB0aGlzLmlkbGVTZXNzaW9uVFRMID0gcHJvcHMuaWRsZVNlc3Npb25UVEwgPz8gRHVyYXRpb24uaG91cnMoMSk7XG4gICAgdGhpcy5zaG91bGRQcmVwYXJlQWdlbnQgPSBwcm9wcy5zaG91bGRQcmVwYXJlQWdlbnQgPz8gZmFsc2U7XG4gICAgdGhpcy51c2VySW5wdXRFbmFibGVkID0gcHJvcHMudXNlcklucHV0RW5hYmxlZCA/PyBmYWxzZTtcbiAgICB0aGlzLmNvZGVJbnRlcnByZXRlckVuYWJsZWQgPSBwcm9wcy5jb2RlSW50ZXJwcmV0ZXJFbmFibGVkID8/IGZhbHNlO1xuICAgIHRoaXMuZm91bmRhdGlvbk1vZGVsID0gcHJvcHMuZm91bmRhdGlvbk1vZGVsO1xuICAgIHRoaXMuZm9yY2VEZWxldGUgPSBwcm9wcy5mb3JjZURlbGV0ZSA/PyBmYWxzZTtcbiAgICAvLyBPcHRpb25hbFxuICAgIHRoaXMuZGVzY3JpcHRpb24gPSBwcm9wcy5kZXNjcmlwdGlvbjtcbiAgICB0aGlzLmluc3RydWN0aW9uID0gcHJvcHMuaW5zdHJ1Y3Rpb247XG4gICAgdGhpcy5wcm9tcHRPdmVycmlkZUNvbmZpZ3VyYXRpb24gPSBwcm9wcy5wcm9tcHRPdmVycmlkZUNvbmZpZ3VyYXRpb247XG4gICAgdGhpcy5rbXNLZXkgPSBwcm9wcy5rbXNLZXk7XG4gICAgdGhpcy5tZW1vcnkgPSBwcm9wcy5tZW1vcnk7XG5cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyBSb2xlXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy8gSWYgZXhpc3Rpbmcgcm9sZSBpcyBwcm92aWRlZCwgdXNlIGl0LlxuICAgIGlmIChwcm9wcy5leGlzdGluZ1JvbGUpIHtcbiAgICAgIHRoaXMucm9sZSA9IHByb3BzLmV4aXN0aW5nUm9sZTtcbiAgICAgIC8vIE90aGVyd2lzZSwgY3JlYXRlIGEgbmV3IG9uZVxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnJvbGUgPSBuZXcgaWFtLlJvbGUodGhpcywgJ1JvbGUnLCB7XG4gICAgICAgIC8vIGdlbmVyYXRlIGEgcm9sZSBuYW1lXG4gICAgICAgIHJvbGVOYW1lOiBnZW5lcmF0ZVBoeXNpY2FsTmFtZVYyKHRoaXMsICdBbWF6b25CZWRyb2NrRXhlY3V0aW9uUm9sZUZvckFnZW50c18nLCB7IG1heExlbmd0aDogNjQsIGxvd2VyOiBmYWxzZSB9KSxcbiAgICAgICAgLy8gZW5zdXJlIHRoZSByb2xlIGhhcyBhIHRydXN0IHBvbGljeSB0aGF0IGFsbG93cyB0aGUgQmVkcm9jayBzZXJ2aWNlIHRvIGFzc3VtZSB0aGUgcm9sZVxuICAgICAgICBhc3N1bWVkQnk6IG5ldyBpYW0uU2VydmljZVByaW5jaXBhbCgnYmVkcm9jay5hbWF6b25hd3MuY29tJykud2l0aENvbmRpdGlvbnMoe1xuICAgICAgICAgIFN0cmluZ0VxdWFsczoge1xuICAgICAgICAgICAgJ2F3czpTb3VyY2VBY2NvdW50JzogU3RhY2sub2YodGhpcykuYWNjb3VudCxcbiAgICAgICAgICB9LFxuICAgICAgICAgIEFybkxpa2U6IHtcbiAgICAgICAgICAgICdhd3M6U291cmNlQXJuJzogU3RhY2sub2YodGhpcykuZm9ybWF0QXJuKHtcbiAgICAgICAgICAgICAgc2VydmljZTogJ2JlZHJvY2snLFxuICAgICAgICAgICAgICByZXNvdXJjZTogJ2FnZW50JyxcbiAgICAgICAgICAgICAgcmVzb3VyY2VOYW1lOiAnKicsXG4gICAgICAgICAgICAgIGFybkZvcm1hdDogQXJuRm9ybWF0LlNMQVNIX1JFU09VUkNFX05BTUUsXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KSxcbiAgICAgIH0pO1xuICAgIH1cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyBTZXQgTGF6eSBQcm9wcyBpbml0aWFsIHZhbHVlc1xuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIHRoaXMua25vd2xlZGdlQmFzZXMgPSBbXTtcbiAgICB0aGlzLmFjdGlvbkdyb3VwcyA9IFtdO1xuICAgIC8vIEFkZCBEZWZhdWx0IEFjdGlvbiBHcm91cHNcbiAgICB0aGlzLmFkZEFjdGlvbkdyb3VwKEFnZW50QWN0aW9uR3JvdXAudXNlcklucHV0KHRoaXMudXNlcklucHV0RW5hYmxlZCkpO1xuICAgIHRoaXMuYWRkQWN0aW9uR3JvdXAoQWdlbnRBY3Rpb25Hcm91cC5jb2RlSW50ZXJwcmV0ZXIodGhpcy5jb2RlSW50ZXJwcmV0ZXJFbmFibGVkKSk7XG5cbiAgICAvLyBBZGQgc3BlY2lmaWVkIGVsZW1zIHRocm91Z2ggbWV0aG9kcyB0byBoYW5kbGUgcGVybWlzc2lvbnNcbiAgICAvLyB0aGlzIG5lZWRzIHRvIGhhcHBlbiBhZnRlciByb2xlIGNyZWF0aW9uIC8gYXNzaWdubWVudFxuICAgIHByb3BzLmtub3dsZWRnZUJhc2VzPy5mb3JFYWNoKGtiID0+IHtcbiAgICAgIHRoaXMuYWRkS25vd2xlZGdlQmFzZShrYik7XG4gICAgfSk7XG4gICAgcHJvcHMuYWN0aW9uR3JvdXBzPy5mb3JFYWNoKGFnID0+IHtcbiAgICAgIHRoaXMuYWRkQWN0aW9uR3JvdXAoYWcpO1xuICAgIH0pO1xuICAgIGlmIChwcm9wcy5ndWFyZHJhaWwpIHtcbiAgICAgIHRoaXMuYWRkR3VhcmRyYWlsKHByb3BzLmd1YXJkcmFpbCk7XG4gICAgfVxuXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy8gU2V0IExhenkgVmFsaWRhdGlvbnNcbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICB0aGlzLm5vZGUuYWRkVmFsaWRhdGlvbih7XG4gICAgICB2YWxpZGF0ZTogKCkgPT4gdGhpcy52YWxpZGF0ZUtub3dsZWRnZUJhc2VBc3NvY2F0aW9ucygpLFxuICAgIH0pO1xuXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy8gQ0ZOIFByb3BzIC0gV2l0aCBMYXp5IHN1cHBvcnRcbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBjb25zdCBjZm5Qcm9wczogYmVkcm9jay5DZm5BZ2VudFByb3BzID0ge1xuICAgICAgYWN0aW9uR3JvdXBzOiBMYXp5LmFueSh7IHByb2R1Y2U6ICgpID0+IHRoaXMucmVuZGVyQWN0aW9uR3JvdXBzKCkgfSwgeyBvbWl0RW1wdHlBcnJheTogdHJ1ZSB9KSxcbiAgICAgIGFnZW50TmFtZTogdGhpcy5uYW1lLFxuICAgICAgYWdlbnRSZXNvdXJjZVJvbGVBcm46IHRoaXMucm9sZS5yb2xlQXJuLFxuICAgICAgYXV0b1ByZXBhcmU6IHRoaXMuc2hvdWxkUHJlcGFyZUFnZW50LFxuICAgICAgY3VzdG9tZXJFbmNyeXB0aW9uS2V5QXJuOiBwcm9wcy5rbXNLZXk/LmtleUFybixcbiAgICAgIGRlc2NyaXB0aW9uOiBwcm9wcy5kZXNjcmlwdGlvbixcbiAgICAgIGZvdW5kYXRpb25Nb2RlbDogdGhpcy5mb3VuZGF0aW9uTW9kZWwuaW52b2thYmxlQXJuLFxuICAgICAgZ3VhcmRyYWlsQ29uZmlndXJhdGlvbjogTGF6eS5hbnkoeyBwcm9kdWNlOiAoKSA9PiB0aGlzLnJlbmRlckd1YXJkcmFpbCgpIH0pLFxuICAgICAgaWRsZVNlc3Npb25UdGxJblNlY29uZHM6IHRoaXMuaWRsZVNlc3Npb25UVEwudG9TZWNvbmRzKCksXG4gICAgICBpbnN0cnVjdGlvbjogcHJvcHMuaW5zdHJ1Y3Rpb24sXG4gICAgICBrbm93bGVkZ2VCYXNlczogTGF6eS5hbnkoeyBwcm9kdWNlOiAoKSA9PiB0aGlzLnJlbmRlcktub3dsZWRnZUJhc2VzKCkgfSwgeyBvbWl0RW1wdHlBcnJheTogdHJ1ZSB9KSxcbiAgICAgIG1lbW9yeUNvbmZpZ3VyYXRpb246IHByb3BzLm1lbW9yeSxcbiAgICAgIHByb21wdE92ZXJyaWRlQ29uZmlndXJhdGlvbjogdGhpcy5wcm9tcHRPdmVycmlkZUNvbmZpZ3VyYXRpb24/Ll9yZW5kZXIoKSxcbiAgICAgIHNraXBSZXNvdXJjZUluVXNlQ2hlY2tPbkRlbGV0ZTogdGhpcy5mb3JjZURlbGV0ZSxcbiAgICB9O1xuXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy8gTDEgSW5zdGFudGlhdGlvblxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIHRoaXMuX19yZXNvdXJjZSA9IG5ldyBiZWRyb2NrLkNmbkFnZW50KHRoaXMsICdBZ2VudFJlc291cmNlJywgY2ZuUHJvcHMpO1xuXG4gICAgdGhpcy5hZ2VudElkID0gdGhpcy5fX3Jlc291cmNlLmF0dHJBZ2VudElkO1xuICAgIHRoaXMuYWdlbnRBcm4gPSB0aGlzLl9fcmVzb3VyY2UuYXR0ckFnZW50QXJuO1xuICAgIHRoaXMuYWdlbnRWZXJzaW9uID0gdGhpcy5fX3Jlc291cmNlLmF0dHJBZ2VudFZlcnNpb247XG4gICAgdGhpcy5sYXN0VXBkYXRlZCA9IHRoaXMuX19yZXNvdXJjZS5hdHRyVXBkYXRlZEF0O1xuXG4gICAgLy8gQWRkIGV4cGxpY2l0IGRlcGVuZGVuY3kgYmV0d2VlbiB0aGUgYWdlbnQgcmVzb3VyY2UgYW5kIHRoZSBhZ2VudCdzIHJvbGUgZGVmYXVsdCBwb2xpY3lcbiAgICAvLyBTZWUgaHR0cHM6Ly9naXRodWIuY29tL2F3c2xhYnMvZ2VuZXJhdGl2ZS1haS1jZGstY29uc3RydWN0cy9pc3N1ZXMvODk5XG4gICAgaWYgKCFwcm9wcy5leGlzdGluZ1JvbGUpIHtcbiAgICAgIC8vIGFkZCB0aGUgYXBwcm9wcmlhdGUgcGVybWlzc2lvbnMgdG8gdXNlIHRoZSBGTVxuICAgICAgY29uc3QgZ3JhbnQgPSB0aGlzLmZvdW5kYXRpb25Nb2RlbC5ncmFudEludm9rZSh0aGlzLnJvbGUpO1xuICAgICAgZ3JhbnQuYXBwbHlCZWZvcmUodGhpcy5fX3Jlc291cmNlKTtcbiAgICB9XG5cbiAgICB0aGlzLnRlc3RBbGlhcyA9IEFnZW50QWxpYXMuZnJvbUF0dHJpYnV0ZXModGhpcywgJ0RlZmF1bHRBbGlhcycsIHtcbiAgICAgIGFsaWFzSWQ6ICdUU1RBTElBU0lEJyxcbiAgICAgIGFsaWFzTmFtZTogJ0FnZW50VGVzdEFsaWFzJyxcbiAgICAgIGFnZW50VmVyc2lvbjogJ0RSQUZUJyxcbiAgICAgIGFnZW50OiB0aGlzLFxuICAgIH0pO1xuICB9XG5cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIEhFTFBFUiBNRVRIT0RTIC0gYWRkWCgpXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvKipcbiAgICogQWRkIGtub3dsZWRnZSBiYXNlIHRvIHRoZSBhZ2VudC5cbiAgICovXG4gIHB1YmxpYyBhZGRLbm93bGVkZ2VCYXNlKGtub3dsZWRnZUJhc2U6IElLbm93bGVkZ2VCYXNlKSB7XG4gICAgLy8gRG8gc29tZSBjaGVja3NcbiAgICB2YWxpZGF0aW9uLnRocm93SWZJbnZhbGlkKHRoaXMudmFsaWRhdGVLbm93bGVkZ2VCYXNlLCBrbm93bGVkZ2VCYXNlKTtcbiAgICAvLyBBZGQgaXQgdG8gdGhlIGFycmF5XG4gICAgdGhpcy5rbm93bGVkZ2VCYXNlcy5wdXNoKGtub3dsZWRnZUJhc2UpO1xuICAgIC8vIEFkZCB0aGUgYXBwcm9wcmlhdGUgUGVybWlzc2lvbnMgdG8gcXVlcnkgdGhlIEtub3dsZWRnZSBCYXNlXG4gICAga25vd2xlZGdlQmFzZS5ncmFudFF1ZXJ5KHRoaXMucm9sZSk7XG4gIH1cblxuICAvKipcbiAgICogQWRkIGd1YXJkcmFpbCB0byB0aGUgYWdlbnQuXG4gICAqL1xuICBwdWJsaWMgYWRkR3VhcmRyYWlsKGd1YXJkcmFpbDogSUd1YXJkcmFpbCkge1xuICAgIC8vIERvIHNvbWUgY2hlY2tzXG4gICAgdmFsaWRhdGlvbi50aHJvd0lmSW52YWxpZCh0aGlzLnZhbGlkYXRlR3VhcmRyYWlsLCBndWFyZHJhaWwpO1xuICAgIC8vIEFkZCBpdCB0byB0aGUgY29uc3RydWN0XG4gICAgdGhpcy5ndWFyZHJhaWwgPSBndWFyZHJhaWw7XG4gICAgLy8gSGFuZGxlIHBlcm1pc3Npb25zXG4gICAgZ3VhcmRyYWlsLmdyYW50QXBwbHkodGhpcy5yb2xlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGQgYW4gYWN0aW9uIGdyb3VwIHRvIHRoZSBhZ2VudC5cbiAgICovXG4gIHB1YmxpYyBhZGRBY3Rpb25Hcm91cChhY3Rpb25Hcm91cDogQWdlbnRBY3Rpb25Hcm91cCkge1xuICAgIC8vIERvIHNvbWUgY2hlY2tzXG4gICAgdmFsaWRhdGlvbi50aHJvd0lmSW52YWxpZCh0aGlzLnZhbGlkYXRlQWN0aW9uR3JvdXAsIGFjdGlvbkdyb3VwKTtcbiAgICAvLyBBZGQgaXQgdG8gdGhlIGFycmF5XG4gICAgdGhpcy5hY3Rpb25Hcm91cHMucHVzaChhY3Rpb25Hcm91cCk7XG4gICAgLy8gSGFuZGxlIHBlcm1pc3Npb25zIHRvIGludm9rZSB0aGUgbGFtYmRhIGZ1bmN0aW9uXG4gICAgYWN0aW9uR3JvdXAuZXhlY3V0b3I/LmxhbWJkYUZ1bmN0aW9uPy5ncmFudEludm9rZSh0aGlzLnJvbGUpO1xuICAgIGFjdGlvbkdyb3VwLmV4ZWN1dG9yPy5sYW1iZGFGdW5jdGlvbj8uYWRkUGVybWlzc2lvbihgTGFtYmRhSW52b2NhdGlvblBvbGljeS0ke3RoaXMubm9kZS5hZGRyLnNsaWNlKDAsIDE2KX1gLCB7XG4gICAgICBwcmluY2lwYWw6IG5ldyBpYW0uU2VydmljZVByaW5jaXBhbCgnYmVkcm9jay5hbWF6b25hd3MuY29tJyksXG4gICAgICBzb3VyY2VBcm46IHRoaXMuYWdlbnRBcm4sXG4gICAgICBzb3VyY2VBY2NvdW50OiBTdGFjay5vZih0aGlzKS5hY2NvdW50LFxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZCBtdWx0aXBsZSBhY3Rpb24gZ3JvdXBzIHRvIHRoZSBhZ2VudC5cbiAgICovXG4gIHB1YmxpYyBhZGRBY3Rpb25Hcm91cHMoLi4uYWN0aW9uR3JvdXBzOiBBZ2VudEFjdGlvbkdyb3VwW10pIHtcbiAgICBhY3Rpb25Hcm91cHMuZm9yRWFjaChhZyA9PiB0aGlzLmFkZEFjdGlvbkdyb3VwKGFnKSk7XG4gIH1cblxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gTGF6eSBSZW5kZXJlcnNcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8qKlxuICAgKiBSZW5kZXIgdGhlIGd1YXJkcmFpbCBjb25maWd1cmF0aW9uLlxuICAgKlxuICAgKiBAaW50ZXJuYWwgVGhpcyBpcyBhbiBpbnRlcm5hbCBjb3JlIGZ1bmN0aW9uIGFuZCBzaG91bGQgbm90IGJlIGNhbGxlZCBkaXJlY3RseS5cbiAgICovXG4gIHByaXZhdGUgcmVuZGVyR3VhcmRyYWlsKCk6IGJlZHJvY2suQ2ZuQWdlbnQuR3VhcmRyYWlsQ29uZmlndXJhdGlvblByb3BlcnR5IHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5ndWFyZHJhaWxcbiAgICAgID8ge1xuICAgICAgICBndWFyZHJhaWxJZGVudGlmaWVyOiB0aGlzLmd1YXJkcmFpbC5ndWFyZHJhaWxJZCxcbiAgICAgICAgZ3VhcmRyYWlsVmVyc2lvbjogdGhpcy5ndWFyZHJhaWwuZ3VhcmRyYWlsVmVyc2lvbixcbiAgICAgIH1cbiAgICAgIDogdW5kZWZpbmVkO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlbmRlciB0aGUga25vd2xlZGdlIGJhc2UgYXNzb2NpYXRpb25zLlxuICAgKlxuICAgKiBAaW50ZXJuYWwgVGhpcyBpcyBhbiBpbnRlcm5hbCBjb3JlIGZ1bmN0aW9uIGFuZCBzaG91bGQgbm90IGJlIGNhbGxlZCBkaXJlY3RseS5cbiAgICovXG4gIHByaXZhdGUgcmVuZGVyS25vd2xlZGdlQmFzZXMoKTogYmVkcm9jay5DZm5BZ2VudC5BZ2VudEtub3dsZWRnZUJhc2VQcm9wZXJ0eVtdIHtcbiAgICBjb25zdCBrbm93bGVkZ2VCYXNlQXNzb2NpYXRpb25zQ2ZuOiBiZWRyb2NrLkNmbkFnZW50LkFnZW50S25vd2xlZGdlQmFzZVByb3BlcnR5W10gPSBbXTtcbiAgICAvLyBCdWlsZCB0aGUgYXNzb2NpYXRpb25zIGluIHRoZSBDRk4gZm9ybWF0XG4gICAgdGhpcy5rbm93bGVkZ2VCYXNlcy5mb3JFYWNoKGtiID0+IHtcbiAgICAgIGtub3dsZWRnZUJhc2VBc3NvY2lhdGlvbnNDZm4ucHVzaCh7XG4gICAgICAgIGtub3dsZWRnZUJhc2VJZDoga2Iua25vd2xlZGdlQmFzZUlkLFxuICAgICAgICBrbm93bGVkZ2VCYXNlU3RhdGU6ICdFTkFCTEVEJyxcbiAgICAgICAgLy8gYXQgbGVhc3Qgb25lIGlzIGRlZmluZWQgYXMgaXQgaGFzIGJlZW4gdmFsaWRhdGVkIHdoZW4gYWRkaW5nIHRoZSBrYlxuICAgICAgICBkZXNjcmlwdGlvbjoga2IuaW5zdHJ1Y3Rpb24gPz8ga2IuZGVzY3JpcHRpb24hLFxuICAgICAgfSk7XG4gICAgfSk7XG4gICAgcmV0dXJuIGtub3dsZWRnZUJhc2VBc3NvY2lhdGlvbnNDZm47XG4gIH1cblxuICAvKipcbiAgICogUmVuZGVyIHRoZSBhY3Rpb24gZ3JvdXBzXG4gICAqXG4gICAqIEBpbnRlcm5hbCBUaGlzIGlzIGFuIGludGVybmFsIGNvcmUgZnVuY3Rpb24gYW5kIHNob3VsZCBub3QgYmUgY2FsbGVkIGRpcmVjdGx5LlxuICAgKi9cbiAgcHJpdmF0ZSByZW5kZXJBY3Rpb25Hcm91cHMoKTogYmVkcm9jay5DZm5BZ2VudC5BZ2VudEFjdGlvbkdyb3VwUHJvcGVydHlbXSB7XG4gICAgY29uc3QgYWN0aW9uR3JvdXBzQ2ZuOiBiZWRyb2NrLkNmbkFnZW50LkFnZW50QWN0aW9uR3JvdXBQcm9wZXJ0eVtdID0gW107XG4gICAgLy8gQnVpbGQgdGhlIGFzc29jaWF0aW9ucyBpbiB0aGUgQ0ZOIGZvcm1hdFxuICAgIHRoaXMuYWN0aW9uR3JvdXBzLmZvckVhY2goYWcgPT4ge1xuICAgICAgYWN0aW9uR3JvdXBzQ2ZuLnB1c2goYWcuX3JlbmRlcigpKTtcbiAgICB9KTtcbiAgICByZXR1cm4gYWN0aW9uR3JvdXBzQ2ZuO1xuICB9XG5cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIFZhbGlkYXRvcnNcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8qKlxuICAgKiBDaGVja3MgaWYgdGhlIEtCIEFzc29jaWF0aW9uIGlzIHZhbGlkXG4gICAqXG4gICAqIEBpbnRlcm5hbCBUaGlzIGlzIGFuIGludGVybmFsIGNvcmUgZnVuY3Rpb24gYW5kIHNob3VsZCBub3QgYmUgY2FsbGVkIGRpcmVjdGx5LlxuICAgKi9cbiAgcHJpdmF0ZSB2YWxpZGF0ZUtub3dsZWRnZUJhc2UgPSAoa25vd2xlZGdlQmFzZTogSUtub3dsZWRnZUJhc2UpOiBzdHJpbmdbXSA9PiB7XG4gICAgY29uc3QgTUFYX0xFTkdUSCA9IDIwMDtcbiAgICBjb25zdCBkZXNjcmlwdGlvbiA9IGtub3dsZWRnZUJhc2UuaW5zdHJ1Y3Rpb24gPz8ga25vd2xlZGdlQmFzZS5kZXNjcmlwdGlvbjtcbiAgICBjb25zdCBlcnJvcnM6IHN0cmluZ1tdID0gW107XG4gICAgLy8gSWYgYXQgbGVhc3Qgb25lIG9mIHRoZSBwcmV2aW91cyBoYXMgYmVlbiBkZWZpbmVkXG4gICAgaWYgKGRlc2NyaXB0aW9uKSB7XG4gICAgICBlcnJvcnMucHVzaChcbiAgICAgICAgLi4udmFsaWRhdGlvbi52YWxpZGF0ZVN0cmluZ0ZpZWxkTGVuZ3RoKHtcbiAgICAgICAgICB2YWx1ZTogZGVzY3JpcHRpb24sXG4gICAgICAgICAgZmllbGROYW1lOiAnZGVzY3JpcHRpb24nLFxuICAgICAgICAgIG1pbkxlbmd0aDogMCxcbiAgICAgICAgICBtYXhMZW5ndGg6IE1BWF9MRU5HVEgsXG4gICAgICAgIH0pLFxuICAgICAgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZXJyb3JzLnB1c2goXG4gICAgICAgICdJZiBpbnN0cnVjdGlvbkZvckFnZW50cyBpcyBub3QgcHJvdmlkZWQsIHRoZSBkZXNjcmlwdGlvbiBwcm9wZXJ0eSBvZiB0aGUgS25vd2xlZGdlQmFzZSAnICtcbiAgICAgICAgICBgJHtrbm93bGVkZ2VCYXNlLmtub3dsZWRnZUJhc2VJZH0gbXVzdCBiZSBwcm92aWRlZC5gLFxuICAgICAgKTtcbiAgICB9XG4gICAgcmV0dXJuIGVycm9ycztcbiAgfTtcbiAgLyoqXG4gICAqIENoZWNrcyBpZiB0aGUgS0IgQXNzb2NpYXRpb25zIGFyZSB2YWxpZFxuICAgKlxuICAgKiBAaW50ZXJuYWwgVGhpcyBpcyBhbiBpbnRlcm5hbCBjb3JlIGZ1bmN0aW9uIGFuZCBzaG91bGQgbm90IGJlIGNhbGxlZCBkaXJlY3RseS5cbiAgICovXG4gIHByaXZhdGUgdmFsaWRhdGVLbm93bGVkZ2VCYXNlQXNzb2NhdGlvbnMgPSAoKTogc3RyaW5nW10gPT4ge1xuICAgIGNvbnN0IE1BWF9LQl9BU1NPQ0lBVElPTlMgPSAxMDtcbiAgICBjb25zdCBlcnJvcnM6IHN0cmluZ1tdID0gW107XG4gICAgaWYgKHRoaXMua25vd2xlZGdlQmFzZXMubGVuZ3RoID4gTUFYX0tCX0FTU09DSUFUSU9OUykge1xuICAgICAgZXJyb3JzLnB1c2goYFRoZSBtYXhpbXVtIG51bWJlciBvZiBrbm93bGVkZ2UgYmFzZXMgYXNzb2NpYXRpb25zIGlzICR7TUFYX0tCX0FTU09DSUFUSU9OU30uYCk7XG4gICAgfVxuICAgIGZvciAoY29uc3Qga2Igb2YgdGhpcy5rbm93bGVkZ2VCYXNlcykge1xuICAgICAgdGhpcy52YWxpZGF0ZUtub3dsZWRnZUJhc2Uoa2IpO1xuICAgIH1cbiAgICByZXR1cm4gZXJyb3JzO1xuICB9O1xuICAvKipcbiAgICogQ2hlY2tzIGlmIHRoZSBHdWFyZHJhaWwgaXMgdmFsaWRcbiAgICpcbiAgICogQGludGVybmFsIFRoaXMgaXMgYW4gaW50ZXJuYWwgY29yZSBmdW5jdGlvbiBhbmQgc2hvdWxkIG5vdCBiZSBjYWxsZWQgZGlyZWN0bHkuXG4gICAqL1xuICBwcml2YXRlIHZhbGlkYXRlR3VhcmRyYWlsID0gKGd1YXJkcmFpbDogSUd1YXJkcmFpbCk6IHN0cmluZ1tdID0+IHtcbiAgICBjb25zdCBlcnJvcnM6IHN0cmluZ1tdID0gW107XG4gICAgaWYgKHRoaXMuZ3VhcmRyYWlsKSB7XG4gICAgICBlcnJvcnMucHVzaChcbiAgICAgICAgYENhbm5vdCBhZGQgR3VhcmRyYWlsICR7Z3VhcmRyYWlsLmd1YXJkcmFpbElkfS4gYCArXG4gICAgICAgICAgYEd1YXJkcmFpbCAke3RoaXMuZ3VhcmRyYWlsLmd1YXJkcmFpbElkfSBoYXMgYWxyZWFkeSBiZWVuIHNwZWNpZmllZCBmb3IgdGhpcyBhZ2VudC5gLFxuICAgICAgKTtcbiAgICB9XG4gICAgZXJyb3JzLnB1c2goLi4udmFsaWRhdGlvbi52YWxpZGF0ZUZpZWxkUGF0dGVybihndWFyZHJhaWwuZ3VhcmRyYWlsVmVyc2lvbiwgJ3ZlcnNpb24nLCAvXigoWzAtOV17MSw4fSl8KERSQUZUKSkkLykpO1xuICAgIHJldHVybiBlcnJvcnM7XG4gIH07XG4gIC8qKlxuICAgKiBDaGVjayBpZiB0aGUgYWN0aW9uIGdyb3VwIGlzIHZhbGlkXG4gICAqL1xuICBwcml2YXRlIHZhbGlkYXRlQWN0aW9uR3JvdXAgPSAoYWN0aW9uR3JvdXA6IEFnZW50QWN0aW9uR3JvdXApID0+IHtcbiAgICBjb25zb2xlLmxvZygnVmFsaWRhdGluZyBhY3Rpb24gZ3JvdXA6ICcsIGFjdGlvbkdyb3VwLm5hbWUpO1xuICAgIGxldCBlcnJvcnM6IHN0cmluZ1tdID0gW107XG4gICAgLy8gRmluZCBpZiB0aGVyZSBpcyBhIGNvbmZsaWN0aW5nIGFjdGlvbiBncm91cCBuYW1lXG4gICAgaWYgKHRoaXMuYWN0aW9uR3JvdXBzPy5maW5kKGFnID0+IGFnLm5hbWUgPT09IGFjdGlvbkdyb3VwLm5hbWUpKSB7XG4gICAgICBlcnJvcnMucHVzaChgQW4gYWN0aW9uIGdyb3VwIHdpdGggbmFtZTogJHthY3Rpb25Hcm91cC5uYW1lfSBoYXMgYWxyZWFkeSBiZWVuIGRlZmluZWRgKTtcbiAgICB9XG4gICAgcmV0dXJuIGVycm9ycztcbiAgfTtcbn1cbiJdfQ==