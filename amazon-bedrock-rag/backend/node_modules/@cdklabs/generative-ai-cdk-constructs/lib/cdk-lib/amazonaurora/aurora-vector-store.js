"use strict";
var _a, _b;
Object.defineProperty(exports, "__esModule", { value: true });
exports.AmazonAuroraVectorStore = exports.ExistingAmazonAuroraVectorStore = exports.SupportedPostgreSQLVersions = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
/**
 *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License"). You may not use this file except in compliance
 *  with the License. A copy of the License is located at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  or in the 'license' file accompanying this file. This file is distributed on an 'AS IS' BASIS, WITHOUT WARRANTIES
 *  OR CONDITIONS OF ANY KIND, express or implied. See the License for the specific language governing permissions
 *  and limitations under the License.
 */
const path = require("path");
const cdk = require("aws-cdk-lib");
const ec2 = require("aws-cdk-lib/aws-ec2");
const iam = require("aws-cdk-lib/aws-iam");
const rds = require("aws-cdk-lib/aws-rds");
const cdk_nag_1 = require("cdk-nag");
const constructs_1 = require("constructs");
const custom_resource_provider_helper_1 = require("../../common/helpers/custom-resource-provider-helper");
const utils_1 = require("../../common/helpers/utils");
const vpc_helper_1 = require("../../common/helpers/vpc-helper");
/**
 * List of supported versions of PostgreSQL for Aurora cluster.
 */
exports.SupportedPostgreSQLVersions = {
    AURORA_POSTGRESQL_V12_16: rds.AuroraPostgresEngineVersion.VER_12_16,
    AURORA_POSTGRESQL_V13_12: rds.AuroraPostgresEngineVersion.VER_13_12,
    AURORA_POSTGRESQL_V14_9: rds.AuroraPostgresEngineVersion.VER_14_9,
    AURORA_POSTGRESQL_V15_4: rds.AuroraPostgresEngineVersion.VER_15_4,
    AURORA_POSTGRESQL_V15_5: rds.AuroraPostgresEngineVersion.VER_15_5,
    AURORA_POSTGRESQL_V15_6: rds.AuroraPostgresEngineVersion.VER_15_6,
    AURORA_POSTGRESQL_V15_7: rds.AuroraPostgresEngineVersion.VER_15_7,
    AURORA_POSTGRESQL_V15_8: rds.AuroraPostgresEngineVersion.VER_15_8,
    AURORA_POSTGRESQL_V16_1: rds.AuroraPostgresEngineVersion.VER_16_1,
    AURORA_POSTGRESQL_V16_2: rds.AuroraPostgresEngineVersion.VER_16_2,
    AURORA_POSTGRESQL_V16_3: rds.AuroraPostgresEngineVersion.VER_16_3,
};
/**
 * Base class for Amazon Aurora Vector Store.
 * Handles both the creation of a new Aurora Vector Store or the usage of an existing Aurora Vector Store.
 */
class BaseAmazonAuroraVectorStore extends constructs_1.Construct {
    constructor(scope, id, props) {
        super(scope, id);
        /**
         * Setup databaseName based on if it is provided in the props or not
         * and based on whether it is an existing Aurora Vector Store or not.
         */
        this.databaseName = 'clusterIdentifier' in props ? props.databaseName : props.databaseName ?? 'bedrock_vector_db';
        this.schemaName = props.schemaName ?? 'bedrock_integration';
        this.vectorField = props.vectorField ?? 'embedding';
        this.textField = props.textField ?? 'chunks';
        this.metadataField = props.metadataField ?? 'metadata';
        this.tableName = props.tableName ?? 'bedrock_kb';
        this.primaryKeyField = props.primaryKeyField ?? 'id';
        this.embeddingsModelVectorDimension = props.embeddingsModelVectorDimension;
    }
    createAuroraPgCRPolicy(clusterIdentifier) {
        const crPolicy = new iam.ManagedPolicy(this, 'AuroraPgPolicy', {
            managedPolicyName: (0, utils_1.generatePhysicalNameV2)(this, 'AuroraPgPolicy', {
                maxLength: 32,
                lower: true,
            }),
            statements: [
                new iam.PolicyStatement({
                    actions: [
                        'ec2:DescribeInstances',
                        'ec2:CreateNetworkInterface',
                        'ec2:AttachNetworkInterface',
                        'ec2:DescribeNetworkInterfaces',
                        'autoscaling:CompleteLifecycleAction',
                        'ec2:DeleteNetworkInterface',
                    ],
                    resources: ['*'],
                }),
                new iam.PolicyStatement({
                    actions: ['rds:DescribeDBClusters'],
                    resources: [
                        cdk.Stack.of(this).formatArn({
                            service: 'rds',
                            resource: 'cluster',
                            resourceName: clusterIdentifier,
                            arnFormat: cdk.ArnFormat.COLON_RESOURCE_NAME,
                            account: cdk.Stack.of(this).account,
                            region: cdk.Stack.of(this).region,
                        }),
                    ],
                }),
            ],
        });
        cdk_nag_1.NagSuppressions.addResourceSuppressions(crPolicy, [
            {
                id: 'AwsSolutions-IAM4',
                reason: 'The AWSLambdaBasicExecutionRole managed policy is required for ' +
                    'the Lambda function to write logs to CloudWatch.',
            },
            {
                id: 'AwsSolutions-IAM5',
                reason: 'This policy is required to allow the custom resource to create a ' +
                    'network interface for the Aurora cluster and it has to be wildcard.',
            },
        ], true);
        return crPolicy;
    }
    generateResourceArn(clusterIdentifier) {
        return cdk.Stack.of(this).formatArn({
            service: 'rds',
            resource: 'cluster',
            resourceName: clusterIdentifier,
            region: cdk.Stack.of(this).region,
            account: cdk.Stack.of(this).account,
            arnFormat: cdk.ArnFormat.COLON_RESOURCE_NAME,
        });
    }
    setupDatabaseClusterResources(vpc, secret, clusterIdentifier, auroraSecurityGroupId) {
        const resourceArn = this.generateResourceArn(clusterIdentifier);
        const auroraSecurityGroup = ec2.SecurityGroup.fromLookupById(this, 'ExistingSG', auroraSecurityGroupId);
        return {
            vpc,
            secret,
            resourceArn,
            auroraSecurityGroup,
            clusterIdentifier,
        };
    }
    createLambdaSecurityGroup(vpc) {
        return new ec2.SecurityGroup(this, 'LambdaSecurityGroup', {
            vpc,
            securityGroupName: 'lambda-security-group',
            description: 'Security group for Lambda access to Aurora',
        });
    }
    addIngressRuleToAuroraSecurityGroup(lambdaSecurityGroup, auroraSecurityGroup) {
        auroraSecurityGroup.addIngressRule(lambdaSecurityGroup, ec2.Port.tcp(5432), 'Allow PostgreSQL access from Lambda security group');
    }
    setupCustomResource(databaseClusterResources, lambdaSecurityGroup, auroraPgCRPolicy) {
        const customResource = (0, custom_resource_provider_helper_1.buildCustomResourceProvider)({
            providerName: 'AmazonAuroraPgVectorCRProvider',
            vpc: databaseClusterResources.vpc,
            securityGroup: lambdaSecurityGroup,
            codePath: path.join(__dirname, '../../../lambda/amazon-aurora-pgvector-custom-resources'),
            handler: 'custom_resources.on_event',
            runtime: cdk.aws_lambda.Runtime.PYTHON_3_12,
        });
        const crProvider = customResource.getProvider(this);
        crProvider.role.addManagedPolicy(auroraPgCRPolicy);
        databaseClusterResources.secret.grantRead(crProvider.role);
        const auroraPgVector = new cdk.CustomResource(this, 'AuroraPgVector', {
            resourceType: 'Custom::AmazonAuroraPgVector',
            serviceToken: crProvider.serviceToken,
            properties: {
                SecretName: databaseClusterResources.secret.secretName || '',
                ClusterIdentifier: databaseClusterResources.clusterIdentifier,
                DatabaseName: this.databaseName,
                TableName: this.tableName,
                VectorDimensions: this.embeddingsModelVectorDimension,
                PrimaryKeyField: this.primaryKeyField,
                SchemaName: this.schemaName,
                VectorField: this.vectorField,
                TextField: this.textField,
                MetadataField: this.metadataField,
            },
        });
        auroraPgVector.node.addDependency(auroraPgCRPolicy);
        return auroraPgVector;
    }
}
class ExistingAmazonAuroraVectorStore extends BaseAmazonAuroraVectorStore {
    constructor(scope, id, props) {
        super(scope, id, props);
        const databaseClusterResources = this.setupDatabaseClusterResources(props.vpc, props.secret, props.clusterIdentifier, props.auroraSecurityGroupId);
        const auroraPgCRPolicy = this.createAuroraPgCRPolicy(databaseClusterResources.clusterIdentifier);
        const lambdaSecurityGroup = this.createLambdaSecurityGroup(databaseClusterResources.vpc);
        this.addIngressRuleToAuroraSecurityGroup(lambdaSecurityGroup, databaseClusterResources.auroraSecurityGroup);
        this.resourceArn = this.generateResourceArn(databaseClusterResources.clusterIdentifier);
        this.credentialsSecretArn = databaseClusterResources.secret.secretArn;
        this.vpc = databaseClusterResources.vpc;
        (0, vpc_helper_1.AddAwsServiceEndpoint)(scope, this.vpc, [
            vpc_helper_1.ServiceEndpointTypeEnum.SECRETS_MANAGER,
            vpc_helper_1.ServiceEndpointTypeEnum.BEDROCK_RUNTIME,
        ]);
        this.setupCustomResource(databaseClusterResources, lambdaSecurityGroup, auroraPgCRPolicy);
    }
}
exports.ExistingAmazonAuroraVectorStore = ExistingAmazonAuroraVectorStore;
_a = JSII_RTTI_SYMBOL_1;
ExistingAmazonAuroraVectorStore[_a] = { fqn: "@cdklabs/generative-ai-cdk-constructs.amazonaurora.ExistingAmazonAuroraVectorStore", version: "0.1.296" };
class AmazonAuroraVectorStore extends BaseAmazonAuroraVectorStore {
    /**
     * Creates an instance of AmazonAuroraVectorStore using existing Aurora Vector Store properties.
     * You need to provide your existing Aurora Vector Store properties
     * such as `databaseName`, `clusterIdentifier`, `vpc` where database is deployed,
     * `secret` containing username and password for authentication to database,
     * and `auroraSecurityGroupId` with the value of a security group id that was
     * used for the database.
     *
     * @param scope - The scope in which to define the construct.
     * @param id - The ID of the construct.
     * @param props - The properties of the existing Aurora Vector Store.
     * @returns An instance of AmazonAuroraVectorStore.
     */
    static fromExistingAuroraVectorStore(scope, id, props) {
        return new ExistingAmazonAuroraVectorStore(scope, id, props);
    }
    constructor(scope, id, props) {
        super(scope, id, props);
        const databaseClusterResources = this.createDatabaseCluster(props.postgreSQLVersion ?? exports.SupportedPostgreSQLVersions.AURORA_POSTGRESQL_V15_5, props.vpc, props.clusterId);
        const auroraPgCRPolicy = this.createAuroraPgCRPolicy(databaseClusterResources.clusterIdentifier);
        const lambdaSecurityGroup = this.createLambdaSecurityGroup(databaseClusterResources.vpc);
        this.addIngressRuleToAuroraSecurityGroup(lambdaSecurityGroup, databaseClusterResources.auroraSecurityGroup);
        this.resourceArn = databaseClusterResources.resourceArn;
        this.credentialsSecretArn = databaseClusterResources.secret.secretArn;
        this.vpc = databaseClusterResources.vpc;
        (0, vpc_helper_1.AddAwsServiceEndpoint)(scope, this.vpc, [
            vpc_helper_1.ServiceEndpointTypeEnum.SECRETS_MANAGER,
            vpc_helper_1.ServiceEndpointTypeEnum.BEDROCK_RUNTIME,
        ]);
        const auroraPgVector = this.setupCustomResource(databaseClusterResources, lambdaSecurityGroup, auroraPgCRPolicy);
        auroraPgVector.node.addDependency(databaseClusterResources.auroraCluster);
    }
    createDatabaseCluster(postgreSQLVersion, existingVpc, clusterIdentifier) {
        const vpc = (0, vpc_helper_1.buildVpc)(this, {
            existingVpc: existingVpc,
            vpcName: `${this.node.id}-vpc`,
        });
        vpc.addFlowLog('VpcFlowLog', {
            destination: ec2.FlowLogDestination.toCloudWatchLogs(),
        });
        const auroraSecurityGroup = new ec2.SecurityGroup(this, 'AuroraSecurityGroup', {
            vpc,
            securityGroupName: 'aurora-security-group',
            description: 'Security group for access to Aurora from Lambda',
        });
        const auroraCluster = new rds.DatabaseCluster(this, 'AuroraCluster', {
            engine: rds.DatabaseClusterEngine.auroraPostgres({
                version: postgreSQLVersion,
            }),
            credentials: rds.Credentials.fromGeneratedSecret('postgres'),
            clusterIdentifier: clusterIdentifier ?? (0, utils_1.generatePhysicalNameV2)(this, 'aurora-serverless', { maxLength: 63, lower: true, separator: '-' }),
            defaultDatabaseName: this.databaseName,
            vpc,
            vpcSubnets: { subnetType: ec2.SubnetType.PRIVATE_ISOLATED },
            securityGroups: [auroraSecurityGroup],
            iamAuthentication: true,
            storageEncrypted: true,
            serverlessV2MinCapacity: 0.5,
            serverlessV2MaxCapacity: 4,
            writer: rds.ClusterInstance.serverlessV2('AuroraServerlessWriter'),
            readers: [rds.ClusterInstance.serverlessV2('AuroraServerlessReader', { scaleWithWriter: true })],
            removalPolicy: cdk.RemovalPolicy.DESTROY,
        });
        const resourceArn = cdk.Stack.of(this).formatArn({
            service: 'rds',
            resource: 'cluster',
            resourceName: auroraCluster.clusterIdentifier,
            arnFormat: cdk.ArnFormat.COLON_RESOURCE_NAME,
        });
        auroraCluster.addRotationSingleUser();
        const cfnDbCluster = auroraCluster.node.defaultChild;
        cfnDbCluster.addOverride('Properties.EnableHttpEndpoint', true);
        cdk_nag_1.NagSuppressions.addResourceSuppressions(auroraCluster, [
            {
                id: 'AwsSolutions-RDS10',
                reason: 'Deletion protection is disabled to make sure a customer can stop ' +
                    'incurring charges if they want to delete the construct.',
            },
        ], true);
        return {
            vpc,
            auroraCluster,
            resourceArn,
            secret: auroraCluster.secret,
            auroraSecurityGroup,
            clusterIdentifier: auroraCluster.clusterIdentifier,
        };
    }
}
exports.AmazonAuroraVectorStore = AmazonAuroraVectorStore;
_b = JSII_RTTI_SYMBOL_1;
AmazonAuroraVectorStore[_b] = { fqn: "@cdklabs/generative-ai-cdk-constructs.amazonaurora.AmazonAuroraVectorStore", version: "0.1.296" };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXVyb3JhLXZlY3Rvci1zdG9yZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jZGstbGliL2FtYXpvbmF1cm9yYS9hdXJvcmEtdmVjdG9yLXN0b3JlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUE7Ozs7Ozs7Ozs7O0dBV0c7QUFFSCw2QkFBNkI7QUFDN0IsbUNBQW1DO0FBQ25DLDJDQUEyQztBQUMzQywyQ0FBMkM7QUFDM0MsMkNBQTJDO0FBRTNDLHFDQUEwQztBQUMxQywyQ0FBdUM7QUFDdkMsMEdBQW1HO0FBQ25HLHNEQUFvRTtBQUNwRSxnRUFBMkc7QUFFM0c7O0dBRUc7QUFDVSxRQUFBLDJCQUEyQixHQUFHO0lBQ3pDLHdCQUF3QixFQUFFLEdBQUcsQ0FBQywyQkFBMkIsQ0FBQyxTQUFTO0lBQ25FLHdCQUF3QixFQUFFLEdBQUcsQ0FBQywyQkFBMkIsQ0FBQyxTQUFTO0lBQ25FLHVCQUF1QixFQUFFLEdBQUcsQ0FBQywyQkFBMkIsQ0FBQyxRQUFRO0lBQ2pFLHVCQUF1QixFQUFFLEdBQUcsQ0FBQywyQkFBMkIsQ0FBQyxRQUFRO0lBQ2pFLHVCQUF1QixFQUFFLEdBQUcsQ0FBQywyQkFBMkIsQ0FBQyxRQUFRO0lBQ2pFLHVCQUF1QixFQUFFLEdBQUcsQ0FBQywyQkFBMkIsQ0FBQyxRQUFRO0lBQ2pFLHVCQUF1QixFQUFFLEdBQUcsQ0FBQywyQkFBMkIsQ0FBQyxRQUFRO0lBQ2pFLHVCQUF1QixFQUFFLEdBQUcsQ0FBQywyQkFBMkIsQ0FBQyxRQUFRO0lBQ2pFLHVCQUF1QixFQUFFLEdBQUcsQ0FBQywyQkFBMkIsQ0FBQyxRQUFRO0lBQ2pFLHVCQUF1QixFQUFFLEdBQUcsQ0FBQywyQkFBMkIsQ0FBQyxRQUFRO0lBQ2pFLHVCQUF1QixFQUFFLEdBQUcsQ0FBQywyQkFBMkIsQ0FBQyxRQUFRO0NBQ3pELENBQUM7QUFrSlg7OztHQUdHO0FBQ0gsTUFBZSwyQkFBNEIsU0FBUSxzQkFBUztJQTJDMUQsWUFD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QUksQ0FBQyxDQUFDO1FBRWhFLHlCQUFlLENBQUMsdUJBQXVCLENBQ3JDLGFBQWEsRUFDYjtZQUNFO2dCQUNFLEVBQUUsRUFBRSxvQkFBb0I7Z0JBQ3hCLE1BQU0sRUFDSixtRUFBbUU7b0JBQ25FLHlEQUF5RDthQUM1RDtTQUNGLEVBQ0QsSUFBSSxDQUNMLENBQUM7UUFFRixPQUFPO1lBQ0wsR0FBRztZQUNILGFBQWE7WUFDYixXQUFXO1lBQ1gsTUFBTSxFQUFFLGFBQWEsQ0FBQyxNQUFPO1lBQzdCLG1CQUFtQjtZQUNuQixpQkFBaUIsRUFBRSxhQUFhLENBQUMsaUJBQWlCO1NBQ25ELENBQUM7SUFDSixDQUFDOztBQXJJSCwwREFzSUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqICBDb3B5cmlnaHQgQW1hem9uLmNvbSwgSW5jLiBvciBpdHMgYWZmaWxpYXRlcy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqXG4gKiAgTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKS4gWW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZVxuICogIHdpdGggdGhlIExpY2Vuc2UuIEEgY29weSBvZiB0aGUgTGljZW5zZSBpcyBsb2NhdGVkIGF0XG4gKlxuICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiAgb3IgaW4gdGhlICdsaWNlbnNlJyBmaWxlIGFjY29tcGFueWluZyB0aGlzIGZpbGUuIFRoaXMgZmlsZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAnQVMgSVMnIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVNcbiAqICBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBleHByZXNzIG9yIGltcGxpZWQuIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9uc1xuICogIGFuZCBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0ICogYXMgY2RrIGZyb20gJ2F3cy1jZGstbGliJztcbmltcG9ydCAqIGFzIGVjMiBmcm9tICdhd3MtY2RrLWxpYi9hd3MtZWMyJztcbmltcG9ydCAqIGFzIGlhbSBmcm9tICdhd3MtY2RrLWxpYi9hd3MtaWFtJztcbmltcG9ydCAqIGFzIHJkcyBmcm9tICdhd3MtY2RrLWxpYi9hd3MtcmRzJztcbmltcG9ydCAqIGFzIHNlY3JldHNtYW5hZ2VyIGZyb20gJ2F3cy1jZGstbGliL2F3cy1zZWNyZXRzbWFuYWdlcic7XG5pbXBvcnQgeyBOYWdTdXBwcmVzc2lvbnMgfSBmcm9tICdjZGstbmFnJztcbmltcG9ydCB7IENvbnN0cnVjdCB9IGZyb20gJ2NvbnN0cnVjdHMnO1xuaW1wb3J0IHsgYnVpbGRDdXN0b21SZXNvdXJjZVByb3ZpZGVyIH0gZnJvbSAnLi4vLi4vY29tbW9uL2hlbHBlcnMvY3VzdG9tLXJlc291cmNlLXByb3ZpZGVyLWhlbHBlcic7XG5pbXBvcnQgeyBnZW5lcmF0ZVBoeXNpY2FsTmFtZVYyIH0gZnJvbSAnLi4vLi4vY29tbW9uL2hlbHBlcnMvdXRpbHMnO1xuaW1wb3J0IHsgQWRkQXdzU2VydmljZUVuZHBvaW50LCBidWlsZFZwYywgU2VydmljZUVuZHBvaW50VHlwZUVudW0gfSBmcm9tICcuLi8uLi9jb21tb24vaGVscGVycy92cGMtaGVscGVyJztcblxuLyoqXG4gKiBMaXN0IG9mIHN1cHBvcnRlZCB2ZXJzaW9ucyBvZiBQb3N0Z3JlU1FMIGZvciBBdXJvcmEgY2x1c3Rlci5cbiAqL1xuZXhwb3J0IGNvbnN0IFN1cHBvcnRlZFBvc3RncmVTUUxWZXJzaW9ucyA9IHtcbiAgQVVST1JBX1BPU1RHUkVTUUxfVjEyXzE2OiByZHMuQXVyb3JhUG9zdGdyZXNFbmdpbmVWZXJzaW9uLlZFUl8xMl8xNixcbiAgQVVST1JBX1BPU1RHUkVTUUxfVjEzXzEyOiByZHMuQXVyb3JhUG9zdGdyZXNFbmdpbmVWZXJzaW9uLlZFUl8xM18xMixcbiAgQVVST1JBX1BPU1RHUkVTUUxfVjE0Xzk6IHJkcy5BdXJvcmFQb3N0Z3Jlc0VuZ2luZVZlcnNpb24uVkVSXzE0XzksXG4gIEFVUk9SQV9QT1NUR1JFU1FMX1YxNV80OiByZHMuQXVyb3JhUG9zdGdyZXNFbmdpbmVWZXJzaW9uLlZFUl8xNV80LFxuICBBVVJPUkFfUE9TVEdSRVNRTF9WMTVfNTogcmRzLkF1cm9yYVBvc3RncmVzRW5naW5lVmVyc2lvbi5WRVJfMTVfNSxcbiAgQVVST1JBX1BPU1RHUkVTUUxfVjE1XzY6IHJkcy5BdXJvcmFQb3N0Z3Jlc0VuZ2luZVZlcnNpb24uVkVSXzE1XzYsXG4gIEFVUk9SQV9QT1NUR1JFU1FMX1YxNV83OiByZHMuQXVyb3JhUG9zdGdyZXNFbmdpbmVWZXJzaW9uLlZFUl8xNV83LFxuICBBVVJPUkFfUE9TVEdSRVNRTF9WMTVfODogcmRzLkF1cm9yYVBvc3RncmVzRW5naW5lVmVyc2lvbi5WRVJfMTVfOCxcbiAgQVVST1JBX1BPU1RHUkVTUUxfVjE2XzE6IHJkcy5BdXJvcmFQb3N0Z3Jlc0VuZ2luZVZlcnNpb24uVkVSXzE2XzEsXG4gIEFVUk9SQV9QT1NUR1JFU1FMX1YxNl8yOiByZHMuQXVyb3JhUG9zdGdyZXNFbmdpbmVWZXJzaW9uLlZFUl8xNl8yLFxuICBBVVJPUkFfUE9TVEdSRVNRTF9WMTZfMzogcmRzLkF1cm9yYVBvc3RncmVzRW5naW5lVmVyc2lvbi5WRVJfMTZfMyxcbn0gYXMgY29uc3Q7XG5cbmV4cG9ydCB0eXBlIFN1cHBvcnRlZFBvc3RncmVTUUxWZXJzaW9ucyA9XG4gICh0eXBlb2YgU3VwcG9ydGVkUG9zdGdyZVNRTFZlcnNpb25zKVtrZXlvZiB0eXBlb2YgU3VwcG9ydGVkUG9zdGdyZVNRTFZlcnNpb25zXTtcblxuLyoqXG4gKiBCYXNlIHByb3BlcnRpZXMgZm9yIGFuIEF1cm9yYSBWZWN0b3IgU3RvcmUuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQmFzZUF1cm9yYVZlY3RvclN0b3JlUHJvcHMge1xuICAvKipcbiAgICogVGhlIHNjaGVtYSBuYW1lIGZvciB0aGUgQXVyb3JhIFZlY3RvciBTdG9yZS5cbiAgICovXG4gIHJlYWRvbmx5IHNjaGVtYU5hbWU/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBmaWVsZCBuYW1lIGZvciB0aGUgdmVjdG9yIGNvbHVtbiBpbiB0aGUgQXVyb3JhIFZlY3RvciBTdG9yZS5cbiAgICovXG4gIHJlYWRvbmx5IHZlY3RvckZpZWxkPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgZmllbGQgbmFtZSBmb3IgdGhlIHRleHQgY29sdW1uIGluIHRoZSBBdXJvcmEgVmVjdG9yIFN0b3JlLlxuICAgKi9cbiAgcmVhZG9ubHkgdGV4dEZpZWxkPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgZmllbGQgbmFtZSBmb3IgdGhlIG1ldGFkYXRhIGNvbHVtbiBpbiB0aGUgQXVyb3JhIFZlY3RvciBTdG9yZS5cbiAgICovXG4gIHJlYWRvbmx5IG1ldGFkYXRhRmllbGQ/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBuYW1lIG9mIHRoZSB0YWJsZSBmb3IgdGhlIEF1cm9yYSBWZWN0b3IgU3RvcmUuXG4gICAqL1xuICByZWFkb25seSB0YWJsZU5hbWU/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBwcmltYXJ5IGtleSBmaWVsZCBmb3IgdGhlIEF1cm9yYSBWZWN0b3IgU3RvcmUgdGFibGUuXG4gICAqL1xuICByZWFkb25seSBwcmltYXJ5S2V5RmllbGQ/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBlbWJlZGRpbmdzIG1vZGVsIGRpbWVuc2lvbiB1c2VkIGZvciB0aGUgQXVyb3JhIFZlY3RvciBTdG9yZS5cbiAgICogVGhlIHZlY3RvciBkaW1lbnNpb25zIG9mIHRoZSBtb2RlbCBtdXN0IG1hdGNoIHRoZSBkaW1lbnNpb25zXG4gICAqIHVzZWQgaW4gdGhlIEtub3dsZWRnZUJhc2UgY29uc3RydWN0LlxuICAgKi9cbiAgcmVhZG9ubHkgZW1iZWRkaW5nc01vZGVsVmVjdG9yRGltZW5zaW9uOiBudW1iZXI7XG59XG5cbi8qKlxuICogUHJvcGVydGllcyBmb3IgY29uZmlndXJpbmcgYW4gQW1hem9uIEF1cm9yYSBWZWN0b3IgU3RvcmUuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQW1hem9uQXVyb3JhVmVjdG9yU3RvcmVQcm9wcyBleHRlbmRzIEJhc2VBdXJvcmFWZWN0b3JTdG9yZVByb3BzIHtcbiAgLyoqXG4gICAqIFRoZSBuYW1lIG9mIHRoZSBkYXRhYmFzZSBmb3IgdGhlIEF1cm9yYSBWZWN0b3IgU3RvcmUuXG4gICAqL1xuICByZWFkb25seSBkYXRhYmFzZU5hbWU/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSB2ZXJzaW9uIG9mIFBvc3RncmVTUUwgdG8gdXNlIGZvciB0aGUgQXVyb3JhIFZlY3RvciBTdG9yZS5cbiAgICogQnkgZGVmYXVsdCwgdGhlIGxhdGVzdCBzdXBwb3J0ZWQgdmVyc2lvbiB3aWxsIGJlIHVzZWQuXG4gICAqL1xuICByZWFkb25seSBwb3N0Z3JlU1FMVmVyc2lvbj86IFN1cHBvcnRlZFBvc3RncmVTUUxWZXJzaW9ucztcblxuICAvKipcbiAgICogVXNlcidzIFZQQyBpbiB3aGljaCB0aGV5IHdhbnQgdG8gZGVwbG95IEF1cm9yYSBEYXRhYmFzZS5cbiAgICovXG4gIHJlYWRvbmx5IHZwYz86IGVjMi5JVnBjO1xuXG4gIC8qKlxuICAgKiBDbHVzdGVyIGlkZW50aWZpZXIuXG4gICAqL1xuICByZWFkb25seSBjbHVzdGVySWQ/OiBzdHJpbmc7XG59XG5cbi8qKlxuICogUHJvcGVydGllcyBmb3IgYW4gZXhpc3RpbmcgQXVyb3JhIFZlY3RvciBTdG9yZS5cbiAqIFlvdSBkYXRhYmFzZSBtdXN0IGhhdmUgVENQL0lQIHBvcnQgdGhhdCB0aGVcbiAqIGRhdGFiYXNlIHdpbGwgdXNlIGZvciBhcHBsaWNhdGlvbiBjb25uZWN0aW9uc1xuICogc2V0IHVwIGZvciBgNTQzMmAuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgRXhpc3RpbmdBbWF6b25BdXJvcmFWZWN0b3JTdG9yZVByb3BzIGV4dGVuZHMgQmFzZUF1cm9yYVZlY3RvclN0b3JlUHJvcHMge1xuICAvKipcbiAgICogVGhlIG5hbWUgb2YgdGhlIGRhdGFiYXNlIGZvciB0aGUgQXVyb3JhIFZlY3RvciBTdG9yZS5cbiAgICovXG4gIHJlYWRvbmx5IGRhdGFiYXNlTmFtZTogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgdW5pcXVlIGNsdXN0ZXIgaWRlbnRpZmllciBvZiB5b3VyIEF1cm9yYSBSRFMgY2x1c3Rlci5cbiAgICovXG4gIHJlYWRvbmx5IGNsdXN0ZXJJZGVudGlmaWVyOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBWUEMgaW4gd2hpY2ggdGhlIGV4aXN0aW5nIEF1cm9yYSBWZWN0b3IgU3RvcmUgaXMgbG9jYXRlZC5cbiAgICovXG4gIHJlYWRvbmx5IHZwYzogZWMyLklWcGM7XG5cbiAgLyoqXG4gICAqIFRoZSBzZWNyZXQgY29udGFpbmluZyB0aGUgZGF0YWJhc2UgY3JlZGVudGlhbHMuXG4gICAqIFRoZSBzZWNyZXQgbXVzdCBjb250YWluIGBob3N0YCwgYHBvcnRgLCBgdXNlcm5hbWVgLFxuICAgKiBgcGFzc3dvcmRgIGFuZCBgZGJuYW1lYCB2YWx1ZXMuXG4gICAqL1xuICByZWFkb25seSBzZWNyZXQ6IHNlY3JldHNtYW5hZ2VyLklTZWNyZXQ7XG5cbiAgLyoqXG4gICAqIFRoZSBpZCBvZiB0aGUgc2VjdXJpdHkgZ3JvdXAgYXNzb2NpYXRlZCB3aXRoIHRoZSBSRFMgQXVyb3JhIGluc3RhbmNlLlxuICAgKiBUaGlzIHNlY3VyaXR5IGdyb3VwIGFsbG93cyBhY2Nlc3MgdG8gdGhlIEF1cm9yYSBWZWN0b3IgU3RvcmUgZnJvbSBMYW1iZGEnc1xuICAgKiBjdXN0b20gcmVzb3VyY2UgcnVubmluZyBwZ1ZlY3RvciBTUUwgY29tbWFuZHMuXG4gICAqL1xuICByZWFkb25seSBhdXJvcmFTZWN1cml0eUdyb3VwSWQ6IHN0cmluZztcbn1cblxuLyoqXG4gKiBJbnRlcmZhY2UgcmVwcmVzZW50aW5nIHRoZSByZXNvdXJjZXMgcmVxdWlyZWQgZm9yIGEgZGF0YWJhc2UgY2x1c3Rlci5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBEYXRhYmFzZUNsdXN0ZXJSZXNvdXJjZXMge1xuICAvKipcbiAgICogVGhlIEFtYXpvbiBBdXJvcmEgUkRTIGNsdXN0ZXIuXG4gICAqL1xuICByZWFkb25seSBhdXJvcmFDbHVzdGVyPzogcmRzLkRhdGFiYXNlQ2x1c3RlcjtcblxuICAvKipcbiAgICogVGhlIEFSTiBvZiB5b3VyIGV4aXN0aW5nIEFtYXpvbiBBdXJvcmEgREIgY2x1c3Rlci5cbiAgICovXG4gIHJlYWRvbmx5IHJlc291cmNlQXJuOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSB1bmlxdWUgY2x1c3RlciBpZGVudGlmaWVyIG9mIHRoZSBBdXJvcmEgUkRTIGNsdXN0ZXIuXG4gICAqL1xuICByZWFkb25seSBjbHVzdGVySWRlbnRpZmllcjogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgVlBDIGluIHdoaWNoIHRoZSBkYXRhYmFzZSBjbHVzdGVyIGlzIGxvY2F0ZWQuXG4gICAqL1xuICByZWFkb25seSB2cGM6IGVjMi5JVnBjO1xuXG4gIC8qKlxuICAgKiBUaGUgc2VjcmV0IGNvbnRhaW5pbmcgdGhlIGRhdGFiYXNlIGNyZWRlbnRpYWxzLlxuICAgKiBUaGUgc2VjcmV0IG11c3QgY29udGFpbiBgdXNlcm5hbWVgIGFuZCBgcGFzc3dvcmRgIHZhbHVlcy5cbiAgICovXG4gIHJlYWRvbmx5IHNlY3JldDogc2VjcmV0c21hbmFnZXIuSVNlY3JldDtcblxuICAvKipcbiAgICogVGhlIHNlY3VyaXR5IGdyb3VwIGFzc29jaWF0ZWQgd2l0aCB0aGUgQXVyb3JhIGNsdXN0ZXIuXG4gICAqL1xuICByZWFkb25seSBhdXJvcmFTZWN1cml0eUdyb3VwOiBlYzIuU2VjdXJpdHlHcm91cDtcbn1cblxuLyoqXG4gKiBCYXNlIGNsYXNzIGZvciBBbWF6b24gQXVyb3JhIFZlY3RvciBTdG9yZS5cbiAqIEhhbmRsZXMgYm90aCB0aGUgY3JlYXRpb24gb2YgYSBuZXcgQXVyb3JhIFZlY3RvciBTdG9yZSBvciB0aGUgdXNhZ2Ugb2YgYW4gZXhpc3RpbmcgQXVyb3JhIFZlY3RvciBTdG9yZS5cbiAqL1xuYWJzdHJhY3QgY2xhc3MgQmFzZUFtYXpvbkF1cm9yYVZlY3RvclN0b3JlIGV4dGVuZHMgQ29uc3RydWN0IHtcbiAgLyoqXG4gICAqIFRoZSBzY2hlbWEgbmFtZSBmb3IgdGhlIEF1cm9yYSBWZWN0b3IgU3RvcmUuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgc2NoZW1hTmFtZTogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgZmllbGQgbmFtZSBmb3IgdGhlIHZlY3RvciBjb2x1bW4gaW4gdGhlIEF1cm9yYSBWZWN0b3IgU3RvcmUuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgdmVjdG9yRmllbGQ6IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIGZpZWxkIG5hbWUgZm9yIHRoZSB0ZXh0IGNvbHVtbiBpbiB0aGUgQXVyb3JhIFZlY3RvciBTdG9yZS5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSB0ZXh0RmllbGQ6IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIGZpZWxkIG5hbWUgZm9yIHRoZSBtZXRhZGF0YSBjb2x1bW4gaW4gdGhlIEF1cm9yYSBWZWN0b3IgU3RvcmUuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgbWV0YWRhdGFGaWVsZDogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgbmFtZSBvZiB0aGUgZGF0YWJhc2UgZm9yIHRoZSBBdXJvcmEgVmVjdG9yIFN0b3JlLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGRhdGFiYXNlTmFtZTogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgbmFtZSBvZiB0aGUgdGFibGUgZm9yIHRoZSBBdXJvcmEgVmVjdG9yIFN0b3JlLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IHRhYmxlTmFtZTogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgcHJpbWFyeSBrZXkgZmllbGQgZm9yIHRoZSBBdXJvcmEgVmVjdG9yIFN0b3JlIHRhYmxlLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IHByaW1hcnlLZXlGaWVsZDogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgZW1iZWRkaW5ncyBtb2RlbCBkaW1lbnNpb24gdXNlZCBmb3IgdGhlIEF1cm9yYSBWZWN0b3IgU3RvcmUuXG4gICAqIFRoZSB2ZWN0b3IgZGltZW5zaW9ucyBvZiB0aGUgbW9kZWwgbXVzdCBtYXRjaCB0aGUgZGltZW5zaW9uc1xuICAgKiB1c2VkIGluIHRoZSBLbm93bGVkZ2VCYXNlIGNvbnN0cnVjdC5cbiAgICovXG4gIHJlYWRvbmx5IGVtYmVkZGluZ3NNb2RlbFZlY3RvckRpbWVuc2lvbjogbnVtYmVyO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHNjb3BlOiBDb25zdHJ1Y3QsXG4gICAgaWQ6IHN0cmluZyxcbiAgICBwcm9wczogQW1hem9uQXVyb3JhVmVjdG9yU3RvcmVQcm9wcyB8IEV4aXN0aW5nQW1hem9uQXVyb3JhVmVjdG9yU3RvcmVQcm9wcyxcbiAgKSB7XG4gICAgc3VwZXIoc2NvcGUsIGlkKTtcblxuICAgIC8qKlxuICAgICAqIFNldHVwIGRhdGFiYXNlTmFtZSBiYXNlZCBvbiBpZiBpdCBpcyBwcm92aWRlZCBpbiB0aGUgcHJvcHMgb3Igbm90XG4gICAgICogYW5kIGJhc2VkIG9uIHdoZXRoZXIgaXQgaXMgYW4gZXhpc3RpbmcgQXVyb3JhIFZlY3RvciBTdG9yZSBvciBub3QuXG4gICAgICovXG4gICAgdGhpcy5kYXRhYmFzZU5hbWUgPSAnY2x1c3RlcklkZW50aWZpZXInIGluIHByb3BzID8gcHJvcHMuZGF0YWJhc2VOYW1lIDogcHJvcHMuZGF0YWJhc2VOYW1lID8/ICdiZWRyb2NrX3ZlY3Rvcl9kYic7XG5cbiAgICB0aGlzLnNjaGVtYU5hbWUgPSBwcm9wcy5zY2hlbWFOYW1lID8/ICdiZWRyb2NrX2ludGVncmF0aW9uJztcbiAgICB0aGlzLnZlY3RvckZpZWxkID0gcHJvcHMudmVjdG9yRmllbGQgPz8gJ2VtYmVkZGluZyc7XG4gICAgdGhpcy50ZXh0RmllbGQgPSBwcm9wcy50ZXh0RmllbGQgPz8gJ2NodW5rcyc7XG4gICAgdGhpcy5tZXRhZGF0YUZpZWxkID0gcHJvcHMubWV0YWRhdGFGaWVsZCA/PyAnbWV0YWRhdGEnO1xuICAgIHRoaXMudGFibGVOYW1lID0gcHJvcHMudGFibGVOYW1lID8/ICdiZWRyb2NrX2tiJztcbiAgICB0aGlzLnByaW1hcnlLZXlGaWVsZCA9IHByb3BzLnByaW1hcnlLZXlGaWVsZCA/PyAnaWQnO1xuICAgIHRoaXMuZW1iZWRkaW5nc01vZGVsVmVjdG9yRGltZW5zaW9uID0gcHJvcHMuZW1iZWRkaW5nc01vZGVsVmVjdG9yRGltZW5zaW9uO1xuICB9XG5cbiAgcHJvdGVjdGVkIGNyZWF0ZUF1cm9yYVBnQ1JQb2xpY3koY2x1c3RlcklkZW50aWZpZXI6IHN0cmluZyk6IGlhbS5NYW5hZ2VkUG9saWN5IHtcbiAgICBjb25zdCBjclBvbGljeSA9IG5ldyBpYW0uTWFuYWdlZFBvbGljeSh0aGlzLCAnQXVyb3JhUGdQb2xpY3knLCB7XG4gICAgICBtYW5hZ2VkUG9saWN5TmFtZTogZ2VuZXJhdGVQaHlzaWNhbE5hbWVWMih0aGlzLCAnQXVyb3JhUGdQb2xpY3knLCB7XG4gICAgICAgIG1heExlbmd0aDogMzIsXG4gICAgICAgIGxvd2VyOiB0cnVlLFxuICAgICAgfSksXG4gICAgICBzdGF0ZW1lbnRzOiBbXG4gICAgICAgIG5ldyBpYW0uUG9saWN5U3RhdGVtZW50KHtcbiAgICAgICAgICBhY3Rpb25zOiBbXG4gICAgICAgICAgICAnZWMyOkRlc2NyaWJlSW5zdGFuY2VzJyxcbiAgICAgICAgICAgICdlYzI6Q3JlYXRlTmV0d29ya0ludGVyZmFjZScsXG4gICAgICAgICAgICAnZWMyOkF0dGFjaE5ldHdvcmtJbnRlcmZhY2UnLFxuICAgICAgICAgICAgJ2VjMjpEZXNjcmliZU5ldHdvcmtJbnRlcmZhY2VzJyxcbiAgICAgICAgICAgICdhdXRvc2NhbGluZzpDb21wbGV0ZUxpZmVjeWNsZUFjdGlvbicsXG4gICAgICAgICAgICAnZWMyOkRlbGV0ZU5ldHdvcmtJbnRlcmZhY2UnLFxuICAgICAgICAgIF0sXG4gICAgICAgICAgcmVzb3VyY2VzOiBbJyonXSxcbiAgICAgICAgfSksXG4gICAgICAgIG5ldyBpYW0uUG9saWN5U3RhdGVtZW50KHtcbiAgICAgICAgICBhY3Rpb25zOiBbJ3JkczpEZXNjcmliZURCQ2x1c3RlcnMnXSxcbiAgICAgICAgICByZXNvdXJjZXM6IFtcbiAgICAgICAgICAgIGNkay5TdGFjay5vZih0aGlzKS5mb3JtYXRBcm4oe1xuICAgICAgICAgICAgICBzZXJ2aWNlOiAncmRzJyxcbiAgICAgICAgICAgICAgcmVzb3VyY2U6ICdjbHVzdGVyJyxcbiAgICAgICAgICAgICAgcmVzb3VyY2VOYW1lOiBjbHVzdGVySWRlbnRpZmllcixcbiAgICAgICAgICAgICAgYXJuRm9ybWF0OiBjZGsuQXJuRm9ybWF0LkNPTE9OX1JFU09VUkNFX05BTUUsXG4gICAgICAgICAgICAgIGFjY291bnQ6IGNkay5TdGFjay5vZih0aGlzKS5hY2NvdW50LFxuICAgICAgICAgICAgICByZWdpb246IGNkay5TdGFjay5vZih0aGlzKS5yZWdpb24sXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICBdLFxuICAgICAgICB9KSxcbiAgICAgIF0sXG4gICAgfSk7XG5cbiAgICBOYWdTdXBwcmVzc2lvbnMuYWRkUmVzb3VyY2VTdXBwcmVzc2lvbnMoXG4gICAgICBjclBvbGljeSxcbiAgICAgIFtcbiAgICAgICAge1xuICAgICAgICAgIGlkOiAnQXdzU29sdXRpb25zLUlBTTQnLFxuICAgICAgICAgIHJlYXNvbjpcbiAgICAgICAgICAgICdUaGUgQVdTTGFtYmRhQmFzaWNFeGVjdXRpb25Sb2xlIG1hbmFnZWQgcG9saWN5IGlzIHJlcXVpcmVkIGZvciAnICtcbiAgICAgICAgICAgICd0aGUgTGFtYmRhIGZ1bmN0aW9uIHRvIHdyaXRlIGxvZ3MgdG8gQ2xvdWRXYXRjaC4nLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgaWQ6ICdBd3NTb2x1dGlvbnMtSUFNNScsXG4gICAgICAgICAgcmVhc29uOlxuICAgICAgICAgICAgJ1RoaXMgcG9saWN5IGlzIHJlcXVpcmVkIHRvIGFsbG93IHRoZSBjdXN0b20gcmVzb3VyY2UgdG8gY3JlYXRlIGEgJyArXG4gICAgICAgICAgICAnbmV0d29yayBpbnRlcmZhY2UgZm9yIHRoZSBBdXJvcmEgY2x1c3RlciBhbmQgaXQgaGFzIHRvIGJlIHdpbGRjYXJkLicsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgICAgdHJ1ZSxcbiAgICApO1xuXG4gICAgcmV0dXJuIGNyUG9saWN5O1xuICB9XG5cbiAgcHJvdGVjdGVkIGdlbmVyYXRlUmVzb3VyY2VBcm4oY2x1c3RlcklkZW50aWZpZXI6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgcmV0dXJuIGNkay5TdGFjay5vZih0aGlzKS5mb3JtYXRBcm4oe1xuICAgICAgc2VydmljZTogJ3JkcycsXG4gICAgICByZXNvdXJjZTogJ2NsdXN0ZXInLFxuICAgICAgcmVzb3VyY2VOYW1lOiBjbHVzdGVySWRlbnRpZmllcixcbiAgICAgIHJlZ2lvbjogY2RrLlN0YWNrLm9mKHRoaXMpLnJlZ2lvbixcbiAgICAgIGFjY291bnQ6IGNkay5TdGFjay5vZih0aGlzKS5hY2NvdW50LFxuICAgICAgYXJuRm9ybWF0OiBjZGsuQXJuRm9ybWF0LkNPTE9OX1JFU09VUkNFX05BTUUsXG4gICAgfSk7XG4gIH1cblxuICBwcm90ZWN0ZWQgc2V0dXBEYXRhYmFzZUNsdXN0ZXJSZXNvdXJjZXMoXG4gICAgdnBjOiBlYzIuSVZwYyxcbiAgICBzZWNyZXQ6IHNlY3JldHNtYW5hZ2VyLklTZWNyZXQsXG4gICAgY2x1c3RlcklkZW50aWZpZXI6IHN0cmluZyxcbiAgICBhdXJvcmFTZWN1cml0eUdyb3VwSWQ6IHN0cmluZyxcbiAgKTogRGF0YWJhc2VDbHVzdGVyUmVzb3VyY2VzIHtcbiAgICBjb25zdCByZXNvdXJjZUFybiA9IHRoaXMuZ2VuZXJhdGVSZXNvdXJjZUFybihjbHVzdGVySWRlbnRpZmllcik7XG4gICAgY29uc3QgYXVyb3JhU2VjdXJpdHlHcm91cCA9IGVjMi5TZWN1cml0eUdyb3VwLmZyb21Mb29rdXBCeUlkKFxuICAgICAgdGhpcyxcbiAgICAgICdFeGlzdGluZ1NHJyxcbiAgICAgIGF1cm9yYVNlY3VyaXR5R3JvdXBJZCxcbiAgICApIGFzIGVjMi5TZWN1cml0eUdyb3VwO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHZwYyxcbiAgICAgIHNlY3JldCxcbiAgICAgIHJlc291cmNlQXJuLFxuICAgICAgYXVyb3JhU2VjdXJpdHlHcm91cCxcbiAgICAgIGNsdXN0ZXJJZGVudGlmaWVyLFxuICAgIH07XG4gIH1cblxuICBwcm90ZWN0ZWQgY3JlYXRlTGFtYmRhU2VjdXJpdHlHcm91cCh2cGM6IGVjMi5JVnBjKTogZWMyLlNlY3VyaXR5R3JvdXAge1xuICAgIHJldHVybiBuZXcgZWMyLlNlY3VyaXR5R3JvdXAodGhpcywgJ0xhbWJkYVNlY3VyaXR5R3JvdXAnLCB7XG4gICAgICB2cGMsXG4gICAgICBzZWN1cml0eUdyb3VwTmFtZTogJ2xhbWJkYS1zZWN1cml0eS1ncm91cCcsXG4gICAgICBkZXNjcmlwdGlvbjogJ1NlY3VyaXR5IGdyb3VwIGZvciBMYW1iZGEgYWNjZXNzIHRvIEF1cm9yYScsXG4gICAgfSk7XG4gIH1cblxuICBwcm90ZWN0ZWQgYWRkSW5ncmVzc1J1bGVUb0F1cm9yYVNlY3VyaXR5R3JvdXAoXG4gICAgbGFtYmRhU2VjdXJpdHlHcm91cDogZWMyLlNlY3VyaXR5R3JvdXAsXG4gICAgYXVyb3JhU2VjdXJpdHlHcm91cDogZWMyLlNlY3VyaXR5R3JvdXAsXG4gICkge1xuICAgIGF1cm9yYVNlY3VyaXR5R3JvdXAuYWRkSW5ncmVzc1J1bGUoXG4gICAgICBsYW1iZGFTZWN1cml0eUdyb3VwLFxuICAgICAgZWMyLlBvcnQudGNwKDU0MzIpLFxuICAgICAgJ0FsbG93IFBvc3RncmVTUUwgYWNjZXNzIGZyb20gTGFtYmRhIHNlY3VyaXR5IGdyb3VwJyxcbiAgICApO1xuICB9XG5cbiAgcHJvdGVjdGVkIHNldHVwQ3VzdG9tUmVzb3VyY2UoXG4gICAgZGF0YWJhc2VDbHVzdGVyUmVzb3VyY2VzOiBEYXRhYmFzZUNsdXN0ZXJSZXNvdXJjZXMsXG4gICAgbGFtYmRhU2VjdXJpdHlHcm91cDogZWMyLlNlY3VyaXR5R3JvdXAsXG4gICAgYXVyb3JhUGdDUlBvbGljeTogaWFtLk1hbmFnZWRQb2xpY3ksXG4gICk6IGNkay5DdXN0b21SZXNvdXJjZSB7XG4gICAgY29uc3QgY3VzdG9tUmVzb3VyY2UgPSBidWlsZEN1c3RvbVJlc291cmNlUHJvdmlkZXIoe1xuICAgICAgcHJvdmlkZXJOYW1lOiAnQW1hem9uQXVyb3JhUGdWZWN0b3JDUlByb3ZpZGVyJyxcbiAgICAgIHZwYzogZGF0YWJhc2VDbHVzdGVyUmVzb3VyY2VzLnZwYyxcbiAgICAgIHNlY3VyaXR5R3JvdXA6IGxhbWJkYVNlY3VyaXR5R3JvdXAsXG4gICAgICBjb2RlUGF0aDogcGF0aC5qb2luKF9fZGlybmFtZSwgJy4uLy4uLy4uL2xhbWJkYS9hbWF6b24tYXVyb3JhLXBndmVjdG9yLWN1c3RvbS1yZXNvdXJjZXMnKSxcbiAgICAgIGhhbmRsZXI6ICdjdXN0b21fcmVzb3VyY2VzLm9uX2V2ZW50JyxcbiAgICAgIHJ1bnRpbWU6IGNkay5hd3NfbGFtYmRhLlJ1bnRpbWUuUFlUSE9OXzNfMTIsXG4gICAgfSk7XG5cbiAgICBjb25zdCBjclByb3ZpZGVyID0gY3VzdG9tUmVzb3VyY2UuZ2V0UHJvdmlkZXIodGhpcyk7XG4gICAgY3JQcm92aWRlci5yb2xlLmFkZE1hbmFnZWRQb2xpY3koYXVyb3JhUGdDUlBvbGljeSk7XG4gICAgZGF0YWJhc2VDbHVzdGVyUmVzb3VyY2VzLnNlY3JldC5ncmFudFJlYWQoY3JQcm92aWRlci5yb2xlKTtcblxuICAgIGNvbnN0IGF1cm9yYVBnVmVjdG9yID0gbmV3IGNkay5DdXN0b21SZXNvdXJjZSh0aGlzLCAnQXVyb3JhUGdWZWN0b3InLCB7XG4gICAgICByZXNvdXJjZVR5cGU6ICdDdXN0b206OkFtYXpvbkF1cm9yYVBnVmVjdG9yJyxcbiAgICAgIHNlcnZpY2VUb2tlbjogY3JQcm92aWRlci5zZXJ2aWNlVG9rZW4sXG4gICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgIFNlY3JldE5hbWU6IGRhdGFiYXNlQ2x1c3RlclJlc291cmNlcy5zZWNyZXQuc2VjcmV0TmFtZSB8fCAnJyxcbiAgICAgICAgQ2x1c3RlcklkZW50aWZpZXI6IGRhdGFiYXNlQ2x1c3RlclJlc291cmNlcy5jbHVzdGVySWRlbnRpZmllcixcbiAgICAgICAgRGF0YWJhc2VOYW1lOiB0aGlzLmRhdGFiYXNlTmFtZSxcbiAgICAgICAgVGFibGVOYW1lOiB0aGlzLnRhYmxlTmFtZSxcbiAgICAgICAgVmVjdG9yRGltZW5zaW9uczogdGhpcy5lbWJlZGRpbmdzTW9kZWxWZWN0b3JEaW1lbnNpb24sXG4gICAgICAgIFByaW1hcnlLZXlGaWVsZDogdGhpcy5wcmltYXJ5S2V5RmllbGQsXG4gICAgICAgIFNjaGVtYU5hbWU6IHRoaXMuc2NoZW1hTmFtZSxcbiAgICAgICAgVmVjdG9yRmllbGQ6IHRoaXMudmVjdG9yRmllbGQsXG4gICAgICAgIFRleHRGaWVsZDogdGhpcy50ZXh0RmllbGQsXG4gICAgICAgIE1ldGFkYXRhRmllbGQ6IHRoaXMubWV0YWRhdGFGaWVsZCxcbiAgICAgIH0sXG4gICAgfSk7XG4gICAgYXVyb3JhUGdWZWN0b3Iubm9kZS5hZGREZXBlbmRlbmN5KGF1cm9yYVBnQ1JQb2xpY3kpO1xuXG4gICAgcmV0dXJuIGF1cm9yYVBnVmVjdG9yO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBFeGlzdGluZ0FtYXpvbkF1cm9yYVZlY3RvclN0b3JlIGV4dGVuZHMgQmFzZUFtYXpvbkF1cm9yYVZlY3RvclN0b3JlIHtcbiAgLyoqXG4gICAqIFRoZSBBUk4gb2YgeW91ciBBbWF6b24gQXVyb3JhIERCIGNsdXN0ZXIuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgcmVzb3VyY2VBcm46IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIFNlY3JldCBBUk4gb2YgeW91ciBBbWF6b24gQXVyb3JhIERCIGNsdXN0ZXIuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgY3JlZGVudGlhbHNTZWNyZXRBcm46IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIFZQQyBvZiB5b3VyIEFtYXpvbiBBdXJvcmEgREIgY2x1c3Rlci5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSB2cGM6IGVjMi5JVnBjO1xuXG4gIGNvbnN0cnVjdG9yKHNjb3BlOiBDb25zdHJ1Y3QsIGlkOiBzdHJpbmcsIHByb3BzOiBFeGlzdGluZ0FtYXpvbkF1cm9yYVZlY3RvclN0b3JlUHJvcHMpIHtcbiAgICBzdXBlcihzY29wZSwgaWQsIHByb3BzKTtcblxuICAgIGNvbnN0IGRhdGFiYXNlQ2x1c3RlclJlc291cmNlcyA9IHRoaXMuc2V0dXBEYXRhYmFzZUNsdXN0ZXJSZXNvdXJjZXMoXG4gICAgICBwcm9wcy52cGMsXG4gICAgICBwcm9wcy5zZWNyZXQsXG4gICAgICBwcm9wcy5jbHVzdGVySWRlbnRpZmllcixcbiAgICAgIHByb3BzLmF1cm9yYVNlY3VyaXR5R3JvdXBJZCxcbiAgICApO1xuXG4gICAgY29uc3QgYXVyb3JhUGdDUlBvbGljeSA9IHRoaXMuY3JlYXRlQXVyb3JhUGdDUlBvbGljeShkYXRhYmFzZUNsdXN0ZXJSZXNvdXJjZXMuY2x1c3RlcklkZW50aWZpZXIpO1xuICAgIGNvbnN0IGxhbWJkYVNlY3VyaXR5R3JvdXAgPSB0aGlzLmNyZWF0ZUxhbWJkYVNlY3VyaXR5R3JvdXAoZGF0YWJhc2VDbHVzdGVyUmVzb3VyY2VzLnZwYyk7XG4gICAgdGhpcy5hZGRJbmdyZXNzUnVsZVRvQXVyb3JhU2VjdXJpdHlHcm91cChsYW1iZGFTZWN1cml0eUdyb3VwLCBkYXRhYmFzZUNsdXN0ZXJSZXNvdXJjZXMuYXVyb3JhU2VjdXJpdHlHcm91cCk7XG5cbiAgICB0aGlzLnJlc291cmNlQXJuID0gdGhpcy5nZW5lcmF0ZVJlc291cmNlQXJuKGRhdGFiYXNlQ2x1c3RlclJlc291cmNlcy5jbHVzdGVySWRlbnRpZmllcik7XG4gICAgdGhpcy5jcmVkZW50aWFsc1NlY3JldEFybiA9IGRhdGFiYXNlQ2x1c3RlclJlc291cmNlcy5zZWNyZXQuc2VjcmV0QXJuO1xuICAgIHRoaXMudnBjID0gZGF0YWJhc2VDbHVzdGVyUmVzb3VyY2VzLnZwYztcblxuICAgIEFkZEF3c1NlcnZpY2VFbmRwb2ludChzY29wZSwgdGhpcy52cGMsIFtcbiAgICAgIFNlcnZpY2VFbmRwb2ludFR5cGVFbnVtLlNFQ1JFVFNfTUFOQUdFUixcbiAgICAgIFNlcnZpY2VFbmRwb2ludFR5cGVFbnVtLkJFRFJPQ0tfUlVOVElNRSxcbiAgICBdKTtcblxuICAgIHRoaXMuc2V0dXBDdXN0b21SZXNvdXJjZShkYXRhYmFzZUNsdXN0ZXJSZXNvdXJjZXMsIGxhbWJkYVNlY3VyaXR5R3JvdXAsIGF1cm9yYVBnQ1JQb2xpY3kpO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBBbWF6b25BdXJvcmFWZWN0b3JTdG9yZSBleHRlbmRzIEJhc2VBbWF6b25BdXJvcmFWZWN0b3JTdG9yZSB7XG4gIC8qKlxuICAgKiBDcmVhdGVzIGFuIGluc3RhbmNlIG9mIEFtYXpvbkF1cm9yYVZlY3RvclN0b3JlIHVzaW5nIGV4aXN0aW5nIEF1cm9yYSBWZWN0b3IgU3RvcmUgcHJvcGVydGllcy5cbiAgICogWW91IG5lZWQgdG8gcHJvdmlkZSB5b3VyIGV4aXN0aW5nIEF1cm9yYSBWZWN0b3IgU3RvcmUgcHJvcGVydGllc1xuICAgKiBzdWNoIGFzIGBkYXRhYmFzZU5hbWVgLCBgY2x1c3RlcklkZW50aWZpZXJgLCBgdnBjYCB3aGVyZSBkYXRhYmFzZSBpcyBkZXBsb3llZCxcbiAgICogYHNlY3JldGAgY29udGFpbmluZyB1c2VybmFtZSBhbmQgcGFzc3dvcmQgZm9yIGF1dGhlbnRpY2F0aW9uIHRvIGRhdGFiYXNlLFxuICAgKiBhbmQgYGF1cm9yYVNlY3VyaXR5R3JvdXBJZGAgd2l0aCB0aGUgdmFsdWUgb2YgYSBzZWN1cml0eSBncm91cCBpZCB0aGF0IHdhc1xuICAgKiB1c2VkIGZvciB0aGUgZGF0YWJhc2UuXG4gICAqXG4gICAqIEBwYXJhbSBzY29wZSAtIFRoZSBzY29wZSBpbiB3aGljaCB0byBkZWZpbmUgdGhlIGNvbnN0cnVjdC5cbiAgICogQHBhcmFtIGlkIC0gVGhlIElEIG9mIHRoZSBjb25zdHJ1Y3QuXG4gICAqIEBwYXJhbSBwcm9wcyAtIFRoZSBwcm9wZXJ0aWVzIG9mIHRoZSBleGlzdGluZyBBdXJvcmEgVmVjdG9yIFN0b3JlLlxuICAgKiBAcmV0dXJucyBBbiBpbnN0YW5jZSBvZiBBbWF6b25BdXJvcmFWZWN0b3JTdG9yZS5cbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgZnJvbUV4aXN0aW5nQXVyb3JhVmVjdG9yU3RvcmUoXG4gICAgc2NvcGU6IENvbnN0cnVjdCxcbiAgICBpZDogc3RyaW5nLFxuICAgIHByb3BzOiBFeGlzdGluZ0FtYXpvbkF1cm9yYVZlY3RvclN0b3JlUHJvcHMsXG4gICk6IEV4aXN0aW5nQW1hem9uQXVyb3JhVmVjdG9yU3RvcmUge1xuICAgIHJldHVybiBuZXcgRXhpc3RpbmdBbWF6b25BdXJvcmFWZWN0b3JTdG9yZShzY29wZSwgaWQsIHByb3BzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGUgQVJOIG9mIHlvdXIgQW1hem9uIEF1cm9yYSBEQiBjbHVzdGVyLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IHJlc291cmNlQXJuOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBTZWNyZXQgQVJOIG9mIHlvdXIgQW1hem9uIEF1cm9yYSBEQiBjbHVzdGVyLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGNyZWRlbnRpYWxzU2VjcmV0QXJuOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBWUEMgb2YgeW91ciBBbWF6b24gQXVyb3JhIERCIGNsdXN0ZXIuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgdnBjOiBlYzIuSVZwYztcblxuICBjb25zdHJ1Y3RvcihzY29wZTogQ29uc3RydWN0LCBpZDogc3RyaW5nLCBwcm9wczogQW1hem9uQXVyb3JhVmVjdG9yU3RvcmVQcm9wcykge1xuICAgIHN1cGVyKHNjb3BlLCBpZCwgcHJvcHMpO1xuXG4gICAgY29uc3QgZGF0YWJhc2VDbHVzdGVyUmVzb3VyY2VzID0gdGhpcy5jcmVhdGVEYXRhYmFzZUNsdXN0ZXIoXG4gICAgICBwcm9wcy5wb3N0Z3JlU1FMVmVyc2lvbiA/PyBTdXBwb3J0ZWRQb3N0Z3JlU1FMVmVyc2lvbnMuQVVST1JBX1BPU1RHUkVTUUxfVjE1XzUsXG4gICAgICBwcm9wcy52cGMsXG4gICAgICBwcm9wcy5jbHVzdGVySWQsXG4gICAgKTtcbiAgICBjb25zdCBhdXJvcmFQZ0NSUG9saWN5ID0gdGhpcy5jcmVhdGVBdXJvcmFQZ0NSUG9saWN5KGRhdGFiYXNlQ2x1c3RlclJlc291cmNlcy5jbHVzdGVySWRlbnRpZmllcik7XG4gICAgY29uc3QgbGFtYmRhU2VjdXJpdHlHcm91cCA9IHRoaXMuY3JlYXRlTGFtYmRhU2VjdXJpdHlHcm91cChkYXRhYmFzZUNsdXN0ZXJSZXNvdXJjZXMudnBjKTtcbiAgICB0aGlzLmFkZEluZ3Jlc3NSdWxlVG9BdXJvcmFTZWN1cml0eUdyb3VwKGxhbWJkYVNlY3VyaXR5R3JvdXAsIGRhdGFiYXNlQ2x1c3RlclJlc291cmNlcy5hdXJvcmFTZWN1cml0eUdyb3VwKTtcblxuICAgIHRoaXMucmVzb3VyY2VBcm4gPSBkYXRhYmFzZUNsdXN0ZXJSZXNvdXJjZXMucmVzb3VyY2VBcm47XG4gICAgdGhpcy5jcmVkZW50aWFsc1NlY3JldEFybiA9IGRhdGFiYXNlQ2x1c3RlclJlc291cmNlcy5zZWNyZXQuc2VjcmV0QXJuO1xuICAgIHRoaXMudnBjID0gZGF0YWJhc2VDbHVzdGVyUmVzb3VyY2VzLnZwYztcblxuICAgIEFkZEF3c1NlcnZpY2VFbmRwb2ludChzY29wZSwgdGhpcy52cGMsIFtcbiAgICAgIFNlcnZpY2VFbmRwb2ludFR5cGVFbnVtLlNFQ1JFVFNfTUFOQUdFUixcbiAgICAgIFNlcnZpY2VFbmRwb2ludFR5cGVFbnVtLkJFRFJPQ0tfUlVOVElNRSxcbiAgICBdKTtcblxuICAgIGNvbnN0IGF1cm9yYVBnVmVjdG9yID0gdGhpcy5zZXR1cEN1c3RvbVJlc291cmNlKGRhdGFiYXNlQ2x1c3RlclJlc291cmNlcywgbGFtYmRhU2VjdXJpdHlHcm91cCwgYXVyb3JhUGdDUlBvbGljeSk7XG5cbiAgICBhdXJvcmFQZ1ZlY3Rvci5ub2RlLmFkZERlcGVuZGVuY3koZGF0YWJhc2VDbHVzdGVyUmVzb3VyY2VzLmF1cm9yYUNsdXN0ZXIhKTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlRGF0YWJhc2VDbHVzdGVyKFxuICAgIHBvc3RncmVTUUxWZXJzaW9uOiBTdXBwb3J0ZWRQb3N0Z3JlU1FMVmVyc2lvbnMsXG4gICAgZXhpc3RpbmdWcGM6IGVjMi5JVnBjIHwgdW5kZWZpbmVkLFxuICAgIGNsdXN0ZXJJZGVudGlmaWVyOiBzdHJpbmcgfCB1bmRlZmluZWQsXG4gICk6IERhdGFiYXNlQ2x1c3RlclJlc291cmNlcyB7XG4gICAgY29uc3QgdnBjID0gYnVpbGRWcGModGhpcywge1xuICAgICAgZXhpc3RpbmdWcGM6IGV4aXN0aW5nVnBjLFxuICAgICAgdnBjTmFtZTogYCR7dGhpcy5ub2RlLmlkfS12cGNgLFxuICAgIH0pO1xuICAgIHZwYy5hZGRGbG93TG9nKCdWcGNGbG93TG9nJywge1xuICAgICAgZGVzdGluYXRpb246IGVjMi5GbG93TG9nRGVzdGluYXRpb24udG9DbG91ZFdhdGNoTG9ncygpLFxuICAgIH0pO1xuXG4gICAgY29uc3QgYXVyb3JhU2VjdXJpdHlHcm91cCA9IG5ldyBlYzIuU2VjdXJpdHlHcm91cCh0aGlzLCAnQXVyb3JhU2VjdXJpdHlHcm91cCcsIHtcbiAgICAgIHZwYyxcbiAgICAgIHNlY3VyaXR5R3JvdXBOYW1lOiAnYXVyb3JhLXNlY3VyaXR5LWdyb3VwJyxcbiAgICAgIGRlc2NyaXB0aW9uOiAnU2VjdXJpdHkgZ3JvdXAgZm9yIGFjY2VzcyB0byBBdXJvcmEgZnJvbSBMYW1iZGEnLFxuICAgIH0pO1xuXG4gICAgY29uc3QgYXVyb3JhQ2x1c3RlciA9IG5ldyByZHMuRGF0YWJhc2VDbHVzdGVyKHRoaXMsICdBdXJvcmFDbHVzdGVyJywge1xuICAgICAgZW5naW5lOiByZHMuRGF0YWJhc2VDbHVzdGVyRW5naW5lLmF1cm9yYVBvc3RncmVzKHtcbiAgICAgICAgdmVyc2lvbjogcG9zdGdyZVNRTFZlcnNpb24sXG4gICAgICB9KSxcbiAgICAgIGNyZWRlbnRpYWxzOiByZHMuQ3JlZGVudGlhbHMuZnJvbUdlbmVyYXRlZFNlY3JldCgncG9zdGdyZXMnKSxcbiAgICAgIGNsdXN0ZXJJZGVudGlmaWVyOiBjbHVzdGVySWRlbnRpZmllciA/PyBnZW5lcmF0ZVBoeXNpY2FsTmFtZVYyKHRoaXMsICdhdXJvcmEtc2VydmVybGVzcycsIHsgbWF4TGVuZ3RoOiA2MywgbG93ZXI6IHRydWUsIHNlcGFyYXRvcjogJy0nIH0pLFxuICAgICAgZGVmYXVsdERhdGFiYXNlTmFtZTogdGhpcy5kYXRhYmFzZU5hbWUsXG4gICAgICB2cGMsXG4gICAgICB2cGNTdWJuZXRzOiB7IHN1Ym5ldFR5cGU6IGVjMi5TdWJuZXRUeXBlLlBSSVZBVEVfSVNPTEFURUQgfSxcbiAgICAgIHNlY3VyaXR5R3JvdXBzOiBbYXVyb3JhU2VjdXJpdHlHcm91cF0sXG4gICAgICBpYW1BdXRoZW50aWNhdGlvbjogdHJ1ZSxcbiAgICAgIHN0b3JhZ2VFbmNyeXB0ZWQ6IHRydWUsXG4gICAgICBzZXJ2ZXJsZXNzVjJNaW5DYXBhY2l0eTogMC41LFxuICAgICAgc2VydmVybGVzc1YyTWF4Q2FwYWNpdHk6IDQsXG4gICAgICB3cml0ZXI6IHJkcy5DbHVzdGVySW5zdGFuY2Uuc2VydmVybGVzc1YyKCdBdXJvcmFTZXJ2ZXJsZXNzV3JpdGVyJyksXG4gICAgICByZWFkZXJzOiBbcmRzLkNsdXN0ZXJJbnN0YW5jZS5zZXJ2ZXJsZXNzVjIoJ0F1cm9yYVNlcnZlcmxlc3NSZWFkZXInLCB7IHNjYWxlV2l0aFdyaXRlcjogdHJ1ZSB9KV0sXG4gICAgICByZW1vdmFsUG9saWN5OiBjZGsuUmVtb3ZhbFBvbGljeS5ERVNUUk9ZLFxuICAgIH0pO1xuICAgIGNvbnN0IHJlc291cmNlQXJuID0gY2RrLlN0YWNrLm9mKHRoaXMpLmZvcm1hdEFybih7XG4gICAgICBzZXJ2aWNlOiAncmRzJyxcbiAgICAgIHJlc291cmNlOiAnY2x1c3RlcicsXG4gICAgICByZXNvdXJjZU5hbWU6IGF1cm9yYUNsdXN0ZXIuY2x1c3RlcklkZW50aWZpZXIsXG4gICAgICBhcm5Gb3JtYXQ6IGNkay5Bcm5Gb3JtYXQuQ09MT05fUkVTT1VSQ0VfTkFNRSxcbiAgICB9KTtcblxuICAgIGF1cm9yYUNsdXN0ZXIuYWRkUm90YXRpb25TaW5nbGVVc2VyKCk7XG5cbiAgICBjb25zdCBjZm5EYkNsdXN0ZXIgPSBhdXJvcmFDbHVzdGVyLm5vZGUuZGVmYXVsdENoaWxkIGFzIHJkcy5DZm5EQkNsdXN0ZXI7XG4gICAgY2ZuRGJDbHVzdGVyLmFkZE92ZXJyaWRlKCdQcm9wZXJ0aWVzLkVuYWJsZUh0dHBFbmRwb2ludCcsIHRydWUpO1xuXG4gICAgTmFnU3VwcHJlc3Npb25zLmFkZFJlc291cmNlU3VwcHJlc3Npb25zKFxuICAgICAgYXVyb3JhQ2x1c3RlcixcbiAgICAgIFtcbiAgICAgICAge1xuICAgICAgICAgIGlkOiAnQXdzU29sdXRpb25zLVJEUzEwJyxcbiAgICAgICAgICByZWFzb246XG4gICAgICAgICAgICAnRGVsZXRpb24gcHJvdGVjdGlvbiBpcyBkaXNhYmxlZCB0byBtYWtlIHN1cmUgYSBjdXN0b21lciBjYW4gc3RvcCAnICtcbiAgICAgICAgICAgICdpbmN1cnJpbmcgY2hhcmdlcyBpZiB0aGV5IHdhbnQgdG8gZGVsZXRlIHRoZSBjb25zdHJ1Y3QuJyxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgICB0cnVlLFxuICAgICk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgdnBjLFxuICAgICAgYXVyb3JhQ2x1c3RlcixcbiAgICAgIHJlc291cmNlQXJuLFxuICAgICAgc2VjcmV0OiBhdXJvcmFDbHVzdGVyLnNlY3JldCEsXG4gICAgICBhdXJvcmFTZWN1cml0eUdyb3VwLFxuICAgICAgY2x1c3RlcklkZW50aWZpZXI6IGF1cm9yYUNsdXN0ZXIuY2x1c3RlcklkZW50aWZpZXIsXG4gICAgfTtcbiAgfVxufVxuIl19