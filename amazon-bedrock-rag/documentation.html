<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contextual Chatbot with Amazon Bedrock</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.6;
            color: #e0e0e0;
            background-color: #1a1a1a;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 900px;
            margin: 40px auto;
            padding: 20px;
            background-color: #2a2a2a;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        h1, h2, h3 {
            color: #4da6ff;
            border-bottom: 2px solid #4da6ff;
            padding-bottom: 10px;
        }
        h1 { font-size: 2.5em; }
        h2 { font-size: 2em; }
        h3 { font-size: 1.5em; }
        p {
            margin-bottom: 1em;
        }
        code {
            background-color: #383838;
            padding: 0.2em 0.4em;
            margin: 0;
            font-size: 85%;
            border-radius: 3px;
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
        }
        pre {
            background-color: #212121;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            border: 1px solid #444;
        }
        pre code {
            padding: 0;
            background-color: transparent;
        }
        ul {
            padding-left: 20px;
        }
        li {
            margin-bottom: 0.5em;
        }
        strong {
            color: #ffb86c;
        }
        .mermaid {
            background-color: #333;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Contextual Chatbot with Amazon Bedrock Knowledge Bases</h1>
        <p>This project provides a fully deployable, self-contained contextual chatbot application using Amazon Bedrock Knowledge Bases. It features a complete backend infrastructure defined in AWS CDK and a simple React frontend.</p>

        <h2>Architecture</h2>
        <p>The entire application is defined as Infrastructure as Code (IaC), allowing for easy and repeatable deployments. The architecture consists of a serverless backend, a document ingestion pipeline, and a web-based frontend.</p>
        <div class="mermaid">
graph TD
    subgraph "User Interaction"
        User[<fa:fa-user> User] -->|1. Accesses UI| FE_CF[<fa:fa-cloud> CloudFront Distribution]
        FE_CF -->|2. Serves static content| FE_S3[<fa:fa-box-archive> S3 Frontend Bucket]
        User -->|3. Sends Query| APIGW[<fa:fa-server> API Gateway]
    end

    subgraph "Data Ingestion"
        Admin[<fa:fa-user-shield> Admin] -->|A. Uploads File| DS_S3[<fa:fa-box-archive> S3 Docs Bucket]
        DS_S3 -->|B. Triggers Event| IngestLambda[<fa:fa-bolt> Ingestion Lambda]
        IngestLambda -->|C. Starts Job| BedrockKB[<fa:fa-brain> Bedrock Knowledge Base]
        DS_S3 -->|Replicates to| DR_S3[<fa:fa-box-archive> S3 DR Bucket]
    end

    subgraph "Backend Logic"
        APIGW -->|4. Invokes| QueryLambda[<fa:fa-bolt> Query Lambda]
        QueryLambda -->|5. Retrieves & Generates| BedrockKB
        BedrockKB -->|6. Returns Response & Citations| QueryLambda
        QueryLambda -->|7. Returns to User| APIGW
    end

    style User fill:#f9f,stroke:#333,stroke-width:2px
    style Admin fill:#ccf,stroke:#333,stroke-width:2px
        </div>

        <h2>Core Components</h2>

        <h3>1. Frontend</h3>
        <ul>
            <li><strong>CloudFront Distribution (<code>AWS::CloudFront::Distribution</code>):</strong> Acts as the primary entry point for users. It serves the frontend application's static files from the S3 bucket and provides caching and HTTPS.</li>
            <li><strong>Frontend S3 Bucket (<code>AWS::S3::Bucket</code>):</strong> A private S3 bucket that stores the built React application (HTML, CSS, JS). Access is restricted to CloudFront via an Origin Access Identity (OAI).</li>
        </ul>

        <h3>2. API Gateway</h3>
        <ul>
            <li><strong>API Gateway (<code>AWS::ApiGateway::RestApi</code>):</strong> Provides a RESTful API endpoint for the frontend to communicate with the backend. It's protected by a Web Application Firewall (WAF).
                <ul>
                    <li><strong><code>/docs</code> (POST):</strong> The primary endpoint for submitting user queries to the chatbot.</li>
                    <li><strong><code>/urls</code> (GET) & <code>/web-urls</code> (POST):</strong> Endpoints for managing the seed URLs for the web crawler data source.</li>
                </ul>
            </li>
        </ul>

        <h3>3. Backend Logic</h3>
        <ul>
            <li><strong>Query Lambda (<code>AWS::Lambda::Function</code>):</strong> The core of the chatbot's logic. It's invoked by the API Gateway and is responsible for:
                <ul>
                    <li>Receiving the user's query.</li>
                    <li>Calling the Bedrock <code>RetrieveAndGenerate</code> API to get an answer from the knowledge base.</li>
                    <li>Returning the response, including citations, to the user.</li>
                </ul>
            </li>
        </ul>

        <h3>4. Data Ingestion & Knowledge Base</h3>
        <ul>
            <li><strong>Docs S3 Bucket (<code>AWS::S3::Bucket</code>):</strong> The primary data source for the knowledge base. When a user uploads a file to this bucket, it triggers the ingestion process. It is configured with versioning and cross-region replication for disaster recovery.</li>
            <li><strong>DR S3 Bucket (<code>AWS::S3::Bucket</code>):</strong> A replica of the Docs S3 Bucket in a different region to ensure data durability.</li>
            <li><strong>Ingestion Lambda (<code>AWS::Lambda::Function</code>):</strong> Triggered by S3 <code>PUT</code> events on the Docs S3 Bucket. This function starts an ingestion job in Bedrock, which processes the new document and adds it to the knowledge base.</li>
            <li><strong>Web Crawler Lambdas (<code>AWS::Lambda::Function</code>):</strong> A set of Lambdas to create, manage, and periodically trigger a web crawling data source for the Bedrock Knowledge Base.</li>
            <li><strong>Bedrock Knowledge Base (<code>Bedrock::VectorKnowledgeBase</code>):</strong> The heart of the RAG pipeline. It automatically chunks and vectorizes documents from the S3 data source and stores them in a vector store for efficient retrieval.</li>
        </ul>

        <h2>Deployment</h2>
        <p>The entire application can be deployed via the AWS CDK.</p>

        <h3>Prerequisites</h3>
        <ul>
            <li>AWS CLI installed and configured with your credentials.</li>
            <li>Node.js and npm installed.</li>
            <li>AWS CDK installed (<code>npm install -g aws-cdk</code>).</li>
            <li>Docker running on your local machine (for bundling Lambda assets).</li>
        </ul>

        <h3>Steps</h3>
        <ol>
            <li><strong>Clone the repository:</strong>
                <pre><code>git clone &lt;repository-url&gt;
cd &lt;repository-name&gt;/backend</code></pre>
            </li>
            <li><strong>Install dependencies:</strong>
                <pre><code>npm install</code></pre>
            </li>
            <li><strong>(Optional) Bootstrap your AWS account for CDK:</strong>
                <p><em>If you've never used CDK in this account/region before.</em></p>
                <pre><code>cdk bootstrap</code></pre>
            </li>
            <li><strong>Synthesize the CloudFormation Template:</strong>
                <p><em>To review the resources that will be created.</em></p>
                <pre><code>cdk synth</code></pre>
            </li>
            <li><strong>Deploy the stack:</strong>
                <pre><code>cdk deploy</code></pre>
            </li>
        </ol>
        <p>After deployment, the CDK will output the URLs for the API Gateway and the CloudFront distribution.</p>

        <h2>Usage</h2>
        <ol>
            <li>Navigate to the <strong>CloudFrontURL</strong> output from the deployment.</li>
            <li>Use the interface to upload documents to the <strong>DocsBucketName</strong> S3 bucket.</li>
            <li>Once the documents are uploaded, the ingestion process will start automatically.</li>
            <li>You can then use the chat interface to ask questions about the documents you've uploaded.</li>
        </ol>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({ startOnLoad: true, theme: 'dark' });
    </script>
</body>
</html>
